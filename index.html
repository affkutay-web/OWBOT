<!--
  Bu dosya, bir Telegram Web UygulamasÄ±'nÄ±
  Firebase Firestore ile entegre ederek Ã§ok kullanÄ±cÄ±lÄ± ve
  gerÃ§ek zamanlÄ± veri saklama Ã¶zelliÄŸine kavuÅŸturur.
  KullanÄ±cÄ±lar bir mini oyundan puan kazanÄ±r ve bu puanlarla
  bir bonus Ã§arkÄ±nÄ± Ã§evirerek kodlar kazanabilir.
-->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã‡arkÄ±felek Web UygulamasÄ±</title>
    <!-- Tailwind CSS'i dahil etme -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Telegram Web App SDK'sÄ±nÄ± dahil etme -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase SDK'larÄ±nÄ± uyumluluk (compat) modunda dahil etme -->
    <!-- Bu, `import` hatalarÄ±nÄ± Ã¶nler ve `firebase` nesnesini global olarak eriÅŸilebilir kÄ±lar. -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <style>
        /* VarsayÄ±lan fontu ayarlama */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* TÃ¼m yÃ¼ksekliÄŸi kaplamalarÄ±nÄ± saÄŸla */
            width: 100%;
            box-sizing: border-box; /* Padding/border'Ä± toplam geniÅŸlik/yÃ¼ksekliÄŸe dahil et */
            overflow: hidden; /* Body'nin kaydÄ±rmasÄ±nÄ± engelle, kaydÄ±rma app-wrapper'da olacak */
        }
        body {
            font-family: 'Inter', sans-serif;
            /* Ana tema arkaplanÄ± mor degrade */
            background: linear-gradient(135deg, #4b0082 0%, #2a0045 100%);
            color: #ffffff; /* VarsayÄ±lan yazÄ±lar beyaz */
            display: flex;
            flex-direction: column; /* Ä°Ã§eriÄŸi dikeyde sÄ±rala */
            align-items: center; /* Yatayda ortala */
            justify-content: flex-start; /* Ä°Ã§eriÄŸi dikeyde yukarÄ±dan baÅŸlat */
        }
        .telegram-btn {
            background-color: var(--tg-theme-button-color, #a78bfa); /* Telegram tema butonu veya mor bir ton */
            color: var(--tg-theme-button-text-color, #ffffff);
            /* Daha dinamik bir dÃ¼ÄŸme gÃ¶rÃ¼nÃ¼mÃ¼ iÃ§in gÃ¶lge ve hafif kabartma */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 2px 5px rgba(0, 0, 0, 0.1), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            transition: all 0.2s ease-in-out; /* YumuÅŸak geÃ§iÅŸler */
        }
        .telegram-btn:hover {
            transform: translateY(-2px); /* Hafif yukarÄ± kalkma efekti */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3), 0 3px 8px rgba(0, 0, 0, 0.15), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
        }
        .telegram-btn:disabled {
            background-color: #555; /* Gri tonu */
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* YÃ¼kleme ekranÄ± stili */
        #loading-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #4b0082; /* Mor arkaplan */
            color: #ffffff; /* Beyaz yazÄ± */
            z-index: 9999;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3); /* Beyaz spinner, daha ÅŸeffaf */
            border-top: 4px solid #a78bfa; /* Mor tonunda spinner Ã¼st kenarÄ± */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Mesaj kutusu iÃ§in stil */
        .message-box { /* Genel bir sÄ±nÄ±f yapÄ±ldÄ± */
            position: absolute; /* ModallarÄ±n iÃ§inde absolute olarak konumlandÄ±rÄ±lacak */
            bottom: 1rem; /* Alttan boÅŸluk */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(51, 51, 51, 0.9); /* Mesaj kutusu iÃ§in daha koyu ve yarÄ± ÅŸeffaf bir arka plan */
            color: #ffffff; /* Beyaz yazÄ± */
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* Daha belirgin gÃ¶lge */
            width: 90%; /* GeniÅŸliÄŸi ayarla */
            max-width: 300px; /* Maksimum geniÅŸlik */
            box-sizing: border-box;
            backdrop-filter: blur(5px); /* Hafif bulanÄ±klÄ±k efekti */
        }
        #message-box-home { /* Anasayfa mesaj kutusu iÃ§in Ã¶zel konumlandÄ±rma */
            position: relative; /* Anasayfa iÃ§eriÄŸine gÃ¶re konumlanÄ±r */
            margin-top: 1.5rem; /* Ãœstten boÅŸluk */
            left: auto;
            transform: none;
            width: auto;
            max-width: none;
        }

        /* Ã‡ark stili (modal iÃ§inde) */
        .wheel-container {
            position: relative;
            width: min(280px, 90vw); /* Ekran geniÅŸliÄŸine gÃ¶re boyutlandÄ±r, max 280px */
            height: min(280px, 90vw); /* En boy oranÄ±nÄ± koru */
            margin: 0 auto;
            border-radius: 50%;
            overflow: hidden; /* Dilimlerin dÄ±ÅŸarÄ± taÅŸmasÄ±nÄ± engelle */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4); /* Daha belirgin gÃ¶lge */
        }
        .wheel {
            position: relative; /* Dilimler iÃ§in konteyner */
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.2, 1); /* HÄ±zlÄ± baÅŸla, yavaÅŸ dur */
            transform-origin: center center;
            overflow: hidden; /* Dilimlerin dÄ±ÅŸarÄ± taÅŸmasÄ±nÄ± engelle */
            background: radial-gradient(circle at center, #3a005f 0%, #1a1a1a 100%); /* Ã‡arkÄ±n ortasÄ±ndan yayÄ±lan degrade */
        }
        .segment { /* Her bir Ã§ark diliminin kapsayÄ±cÄ±sÄ± */
            position: absolute;
            width: 50%;   /* YarÄ±Ã§ap kadar geniÅŸlik */
            height: 100%; /* Tam Ã§ap kadar yÃ¼kseklik */
            top: 0;
            left: 50%;    /* Ã‡arkÄ±n merkezinden baÅŸla */
            transform-origin: 0% 50%; /* DÃ¶nÃ¼ÅŸ noktasÄ± Ã§arkÄ±n merkezi */
            overflow: hidden; /* Ä°Ã§erideki renkli kÄ±smÄ± gizlemek iÃ§in */
            transform: rotate(var(--rotation-angle)); /* Dilimi kendi yerine dÃ¶ndÃ¼r */
        }
        .segment-color-fill { /* Dilimin renkli gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ veren kÄ±sÄ±m */
            position: absolute;
            width: 100%; /* KapsayÄ±cÄ±nÄ±n tam geniÅŸliÄŸi */
            height: 100%; /* KapsayÄ±cÄ±nÄ±n tam yÃ¼ksekliÄŸi */
            left: 0;
            top: 0;
            background-color: var(--segment-color);
            transform-origin: 0% 50%; /* KapsayÄ±cÄ±nÄ±n sol ortasÄ±ndan dÃ¶n */
            transform: rotate(var(--segment-sweep-angle)); /* Dilimin yayÄ±nÄ± oluÅŸturmak iÃ§in dÃ¶ndÃ¼r */
            border-radius: 0 100% 100% 0 / 50%; /* YarÄ±m daire ÅŸekli */
            opacity: 0.9; /* Hafif ÅŸeffaflÄ±k */
        }
        .segment-label { /* Dilim Ã¼zerindeki okunabilir metin */
            position: absolute;
            top: 50%; /* Dikeyde ortala */
            left: 75%; /* Merkeze gÃ¶re dÄ±ÅŸa doÄŸru konumlandÄ±r */
            transform: translate(-50%, -50%) rotate(calc(-1 * var(--rotation-angle))); /* Yatayda tutmak iÃ§in karÅŸÄ±t dÃ¶nÃ¼ÅŸ */
            white-space: nowrap;
            font-size: 0.8em;
            font-weight: bold;
            color: #ffffff; /* Beyaz metin */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7); /* Daha belirgin gÃ¶lge */
            z-index: 2; /* Metin dilimin Ã¼stÃ¼nde olsun */
            pointer-events: none; /* Metnin tÄ±klamayÄ± engellememesi iÃ§in */
            padding: 0 5px; /* Kenarlardan boÅŸluk */
            box-sizing: border-box;
        }
        .wheel-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #fcd34d; /* SarÄ±msÄ± renkte ok */
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        /* Sabit baÅŸlÄ±k stili */
        #app-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(90deg, #2a0045 0%, #4b0082 100%); /* BaÅŸlÄ±k iÃ§in degrade */
            color: #ffffff;
            padding: 1rem 1.5rem; /* Yanlara ve dikeyde boÅŸluk */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4); /* Daha belirgin gÃ¶lge */
            z-index: 10000; /* DiÄŸer her ÅŸeyin Ã¼stÃ¼nde olsun */
            display: flex;
            justify-content: space-between; /* Ä°Ã§eriÄŸi iki yana yasla */
            align-items: center; /* Dikeyde ortala */
            box-sizing: border-box;
            height: 60px; /* BaÅŸlÄ±k iÃ§in sabit yÃ¼kseklik */
        }
        #app-header .title {
            font-size: 1.6rem; /* Biraz daha bÃ¼yÃ¼k baÅŸlÄ±k */
            font-weight: 900;
            letter-spacing: 0.05em; /* Harf aralÄ±ÄŸÄ± */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #app-header .user-info-display {
            text-align: right;
            font-size: 0.9rem;
        }
        #app-header .points-display {
            font-size: 1.2rem; /* Daha bÃ¼yÃ¼k puan yazÄ±sÄ± */
            font-weight: bold;
            color: #fcd34d; /* SarÄ±msÄ± renk puanlar iÃ§in */
            text-shadow: 0 0 5px rgba(252, 211, 77, 0.5); /* Hafif parlama */
        }

        #app-wrapper {
            flex-grow: 1; /* Kalan tÃ¼m dikey boÅŸluÄŸu doldur */
            width: 100%;
            max-width: 600px; /* Genel iÃ§erik iÃ§in maksimum geniÅŸlik */
            margin-top: 60px; /* Sabit baÅŸlÄ±ÄŸÄ±n altÄ±ndan baÅŸla */
            overflow-y: auto; /* Kendi iÃ§inde dikey kaydÄ±rma */
            -webkit-overflow-scrolling: touch; /* iOS'ta daha akÄ±cÄ± kaydÄ±rma */
            display: flex; /* Ä°Ã§eriÄŸini dikeyde sÄ±ralamak iÃ§in */
            flex-direction: column;
            padding-bottom: 1.5rem; /* En alt kartÄ±n altÄ±ndan boÅŸluk */
        }

        #home-page-content {
            padding: 1.5rem; /* Ä°Ã§ padding */
            background-color: rgba(26, 26, 26, 0.8); /* Uygulama kapsayÄ±cÄ±sÄ± iÃ§in koyu ÅŸeffaf */
            border-radius: 0.75rem; /* Daha belirgin yuvarlak kÃ¶ÅŸeler */
            margin: 1.5rem; /* app-wrapper iÃ§inde Ã¼stten alttan boÅŸluk */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); /* Daha bÃ¼yÃ¼k ve derin gÃ¶lge */
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* BÃ¶lÃ¼mler arasÄ± boÅŸluk */
            align-items: center; /* Ä°Ã§erikleri yatayda ortala */
            flex-grow: 1; /* Home page iÃ§eriÄŸinin de kendi iÃ§inde bÃ¼yÃ¼mesini saÄŸlar */
            backdrop-filter: blur(8px); /* Hafif bulanÄ±klÄ±k efekti */
            border: 1px solid rgba(255, 255, 255, 0.1); /* Ä°nce beyaz kenarlÄ±k */
        }
        
        /* BaÅŸlÄ±klar iÃ§in renk gÃ¼ncellemesi */
        h1, h2 {
            color: #fcd34d; /* BaÅŸlÄ±klar sarÄ±msÄ± olsun */
            font-weight: 900; /* Daha kalÄ±n ve etkileyici */
            text-shadow: 0 0 8px rgba(252, 211, 77, 0.6); /* Hafif parlama */
        }

        /* TÃ¼m kÃ¼Ã§Ã¼k yazÄ±larÄ± beyaz yapalÄ±m */
        .text-gray-600 {
            color: #e0e0e0; /* Daha aÃ§Ä±k gri tonu, daha okunabilir */
        }

        /* KullanÄ±cÄ± adÄ± giriÅŸ modal stili */
        #username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Daha koyu arka plan */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(8px); /* BulanÄ±klÄ±k efekti */
        }
        .username-modal-content {
            background: linear-gradient(180deg, #1a1a1a 0%, #333333 100%); /* Degradeli arka plan */
            padding: 2.5rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5); /* Daha bÃ¼yÃ¼k gÃ¶lge */
            max-width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .username-modal-content input {
            width: 100%;
            padding: 0.75rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #555; /* Daha belirgin kenarlÄ±k */
            background-color: #2a2a2a;
            color: #ffffff;
            font-size: 1em;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3); /* Ä°Ã§ gÃ¶lge */
        }
        .username-modal-content button {
            width: 100%;
            padding: 0.9rem; /* Daha bÃ¼yÃ¼k padding */
            border-radius: 0.75rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            background-color: #a78bfa;
            color: #ffffff;
            font-weight: bold;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), inset 0 -2px 0 rgba(0, 0, 0, 0.1);
        }
        .username-modal-content button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3), inset 0 -2px 0 rgba(0, 0, 0, 0.1);
        }

        /* Genel Modal Stili (Ã‡ark, HÄ±zlÄ± TÄ±kla, SayÄ± Tahmin, TaÅŸ KaÄŸÄ±t Makas) */
        .game-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Daha koyu yarÄ± saydam arka plan */
            display: none; /* VarsayÄ±lan olarak gizli */
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease; /* Sadece opacity geÃ§iÅŸi */
            backdrop-filter: blur(8px); /* BulanÄ±klÄ±k efekti */
        }
        .game-modal.open {
            opacity: 1;
            /* display: flex; JavaScript tarafÄ±ndan yÃ¶netilecek */
        }
        .game-modal-content {
            background: linear-gradient(180deg, #1a1a1a 0%, #333333 100%); /* Degradeli arka plan */
            padding: 2.5rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5); /* Daha bÃ¼yÃ¼k gÃ¶lge */
            max-width: 90%;
            width: 400px; /* Modal iÃ§in sabit geniÅŸlik */
            position: relative; /* Mesaj kutusu iÃ§in gÃ¶receli konum */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-modal-close-btn { /* Modal kapatma butonu iÃ§in genel sÄ±nÄ±f */
            position: absolute;
            top: 15px; /* Konumu ayarla */
            right: 15px; /* Konumu ayarla */
            background: none;
            border: none;
            color: #fcd34d; /* SarÄ±msÄ± renk */
            font-size: 2.2em; /* Daha bÃ¼yÃ¼k */
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .game-modal-close-btn:hover {
            transform: rotate(90deg); /* KapatÄ±rken dÃ¶nme efekti */
        }

        /* Oyun kartÄ± stili (Ana sayfadaki gÃ¶rsel) */
        .game-card-homepage { /* Ana sayfadaki tÄ±klanabilir oyun kartlarÄ± */
            background: linear-gradient(145deg, #2a0045 0%, #4b0082 100%); /* Degradeli arka plan */
            padding: 1.5rem;
            border-radius: 1rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease-in-out; /* YumuÅŸak geÃ§iÅŸler */
            max-width: 300px; /* Orta boyutlu kart */
            width: 100%; /* Mobil uyumluluk */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3), inset 0 2px 5px rgba(255, 255, 255, 0.1); /* Daha belirgin ve iÃ§ gÃ¶lge */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-card-homepage:hover {
            transform: translateY(-8px) scale(1.02); /* Daha belirgin bÃ¼yÃ¼me ve kalkma */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), inset 0 2px 8px rgba(255, 255, 255, 0.2);
        }
        .game-card-homepage img {
            width: 100px; /* Resim boyutu */
            height: 100px;
            margin: 0 auto 1rem auto;
            border-radius: 50%; /* Yuvarlak resim */
            object-fit: cover;
            border: 3px solid #fcd34d; /* SarÄ±msÄ± Ã§erÃ§eve */
            box-shadow: 0 0 15px rgba(252, 211, 77, 0.5); /* Resme parlama efekti */
            transition: all 0.3s ease-in-out;
        }
        .game-card-homepage:hover img {
            transform: scale(1.05); /* Hover'da resmin de bÃ¼yÃ¼mesi */
            box-shadow: 0 0 20px rgba(252, 211, 77, 0.8);
        }
        
        /* Mini Oyunlar bÃ¶lÃ¼mÃ¼ stili */
        #mini-games-section {
            width: 100%;
            background: linear-gradient(160deg, #2a0045 0%, #3a005f 100%); /* Degradeli arka plan */
            padding: 2rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex; /* Ä°Ã§indeki oyunlarÄ± da flex ile sÄ±rala */
            flex-direction: column;
            gap: 1.5rem; /* Oyunlar arasÄ± boÅŸluk */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Bonus KodlarÄ± bÃ¶lÃ¼mÃ¼ stili */
        #bonus-codes-list-section {
            width: 100%;
            background: linear-gradient(160deg, #2a0045 0%, #3a005f 100%); /* Degradeli arka plan */
            padding: 2rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak kÃ¶ÅŸeler */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #bonus-codes-list li {
            background-color: rgba(75, 0, 130, 0.3); /* Listeler iÃ§in ÅŸeffaf mor arkaplan */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        #bonus-codes-list li::before {
            content: 'ğŸ’'; /* Elmas emojisi */
            font-size: 1.2em;
        }

        /* TaÅŸ-KaÄŸÄ±t-Makas butonlarÄ± iÃ§in dÃ¼zen */
        #rps-choices {
            display: flex;
            justify-content: center;
            gap: 0.75rem; /* Butonlar arasÄ±nda boÅŸluk */
            margin-bottom: 1rem;
        }
        #rps-choices .rps-btn {
            padding: 0.75rem 1.25rem;
            font-size: 1.1em;
            font-weight: bold;
            flex: 1; /* EÅŸit geniÅŸlik */
            max-width: 120px; /* Maksimum geniÅŸlik */
            /* telegram-btn'in stilini kullanÄ±r */
        }
        #rps-result-display-text {
            font-weight: bold;
            margin-bottom: 1rem;
            font-size: 1.3em; /* Daha bÃ¼yÃ¼k metin */
            text-shadow: 0 0 5px rgba(255,255,255,0.7);
        }
        #rps-play-again-button {
            background-color: #555; /* Gri tonu */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
        }
        #rps-play-again-button:hover {
            background-color: #666;
            transform: translateY(-1px);
        }
        #rps-player-choice-display, #rps-computer-choice-display {
            font-weight: bold;
            color: #fcd34d; /* SarÄ±msÄ± renk */
            text-shadow: 0 0 5px rgba(252, 211, 77, 0.5);
        }
    </style>
</head>
<body>
    <!-- YÃ¼kleme EkranÄ± -->
    <div id="loading-screen" class="space-y-4">
        <div class="spinner"></div>
        <p class="text-sm">BaÄŸlanÄ±yor...</p>
    </div>

    <!-- KullanÄ±cÄ± AdÄ± Belirleme ModalÄ± -->
    <div id="username-modal" class="hidden">
        <div class="username-modal-content">
            <h2 class="text-xl font-bold mb-4">HoÅŸ Geldin!</h2>
            <p class="text-sm text-gray-600">Devam etmek iÃ§in bir kullanÄ±cÄ± adÄ± belirle.</p>
            <input type="text" id="username-input" placeholder="KullanÄ±cÄ± adÄ±nÄ± gir..." maxlength="20">
            <button id="save-username-btn" class="telegram-btn">KullanÄ±cÄ± AdÄ±nÄ± Kaydet</button>
        </div>
    </div>

    <!-- Sabit Uygulama BaÅŸlÄ±ÄŸÄ± -->
    <header id="app-header">
        <div class="flex items-center">
            <span class="title">Ã‡arkÄ±felek UygulamasÄ±</span>
        </div>
        <div class="user-info-display">
            <p id="user-info-header" class="text-sm font-semibold">YÃ¼kleniyor...</p>
            <p id="points-display-header" class="points-display">Puan: 0</p>
        </div>
    </header>

    <!-- Ana Uygulama Ä°Ã§eriÄŸi (KaydÄ±rÄ±labilir Alan) -->
    <div id="app-wrapper">
        <div id="home-page-content" class="text-center hidden">
            <h1 class="text-3xl font-bold mb-4">HoÅŸ Geldin!</h1>
            <p class="text-sm text-gray-600 mb-6">Puan kazanmak ve bonus kodlarÄ± almak iÃ§in oyna!</p>

            <!-- Mini Oyunlar BÃ¶lÃ¼mÃ¼ -->
            <section id="mini-games-section" class="w-full">
                <h2 class="text-xl font-bold mb-4">Mini Oyunlar</h2>
                <p class="text-sm text-gray-600 mb-4">Puan toplamak iÃ§in farklÄ± oyun seÃ§enekleri.</p>
                
                <!-- Mini Oyun KartÄ±: HÄ±zlÄ± TÄ±kla! -->
                <div id="fast-click-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/6f2da8/FFFFFF?text=TIKLA" alt="HÄ±zlÄ± TÄ±kla!" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">HÄ±zlÄ± TÄ±kla!</h3>
                    <p class="text-sm text-gray-600">Butona basarak puan kazan.</p>
                </div>

                <!-- Mini Oyun KartÄ±: SayÄ± Tahmin Oyunu -->
                <div id="guess-game-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/8a2be2/FFFFFF?text=SAYI" alt="SayÄ± Tahmin Oyunu" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">SayÄ± Tahmin Oyunu</h3>
                    <p class="text-sm text-gray-600">SayÄ±yÄ± tahmin et, puanÄ± kap!</p>
                </div>

                <!-- Mini Oyun KartÄ±: TaÅŸ, KaÄŸÄ±t, Makas -->
                <div id="rps-game-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/b19cd9/FFFFFF?text=RPS" alt="TaÅŸ, KaÄŸÄ±t, Makas" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">TaÅŸ, KaÄŸÄ±t, Makas!</h3>
                    <p class="text-sm text-gray-600">BilgisayarÄ± yen ve puan kazan.</p>
                </div>
            </section>
            
            <!-- Ã‡arkÄ±felek KartÄ± -->
            <div id="wheel-card" class="game-card-homepage">
                <img src="https://placehold.co/100x100/A78BFA/FFFFFF?text=Ã‡ARK" alt="Ã‡arkÄ±felek" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                <h3 class="text-xl font-bold mb-2">Bonus Ã‡arkÄ±</h3>
                <p class="text-sm text-gray-600">Ã‡evirmek iÃ§in tÄ±kla ve bonus kazan!</p>
            </div>

            <!-- Bonus KodlarÄ± BÃ¶lÃ¼mÃ¼ -->
            <section id="bonus-codes-list-section" class="w-full">
                <h2 class="text-xl font-bold mb-4">KazanÄ±lan Bonus KodlarÄ±</h2>
                <ul id="bonus-codes-list" class="text-sm text-gray-600 space-y-2">
                    <!-- Bonus kodlarÄ± buraya eklenecek -->
                </ul>
            </section>

            <!-- Mesaj kutusu Ã¶ÄŸesi -->
            <div id="message-box-home" class="message-box"></div>
        </div>
    </div>

    <!-- TÃ¼m Oyun ModallarÄ± -->

    <!-- Ã‡arkÄ±felek ModalÄ± -->
    <div id="wheel-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="wheel-modal-close-btn" class="game-modal-close-btn">Ã—</button>
            <h2 class="text-xl font-bold mb-4">Bonus Ã‡arkÄ±</h2>
            <p class="text-sm text-gray-600 mb-4">Ã‡arkÄ± Ã§evirmek iÃ§in 100 puana ihtiyacÄ±n var.</p>
            <div class="wheel-container">
                <div class="wheel-marker"></div>
                <div id="wheel-element" class="wheel">
                    <!-- Ã‡ark dilimleri ve metin etiketleri dinamik olarak eklenecek -->
                </div>
            </div>
            <button id="wheel-spin-button" class="telegram-btn w-full py-3 mt-6 transition duration-200 hover:opacity-80 disabled:opacity-50" disabled>
                <span id="spin-button-text">Ã‡arkÄ± Ã‡evir (100 Puan)</span>
            </button>
            <!-- Mesaj kutusu Ã¶ÄŸesi (modal iÃ§inde) -->
            <div id="message-box-wheel-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- HÄ±zlÄ± TÄ±kla! ModalÄ± -->
    <div id="fast-click-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="fast-click-modal-close-btn" class="game-modal-close-btn">Ã—</button>
            <h2 class="text-xl font-bold mb-4">HÄ±zlÄ± TÄ±kla!</h2>
            <p class="text-sm text-gray-600 mb-3">Butona her tÄ±kladÄ±ÄŸÄ±nÄ±zda 10 puan kazanÄ±rsÄ±nÄ±z.</p>
            <button id="fast-click-game-button" class="telegram-btn w-full py-3 transition duration-200 hover:opacity-80">
                <span id="fast-click-game-button-text">Puan Kazan (+10)</span>
            </button>
            <div id="message-box-fast-click-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- SayÄ± Tahmin Oyunu ModalÄ± -->
    <div id="guess-game-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="guess-game-modal-close-btn" class="game-modal-close-btn">Ã—</button>
            <h2 class="text-xl font-bold mb-4">SayÄ± Tahmin Oyunu</h2>
            <p class="text-sm text-gray-600 mb-3">1 ile 100 arasÄ±nda bir sayÄ± tuttum. 7 tahmin hakkÄ±n var!</p>
            <input type="number" id="guess-game-input" class="w-full p-2 mb-3 rounded-md bg-gray-700 text-white border-none text-center" placeholder="Tahminini gir (1-100)">
            <button id="guess-game-submit-button" class="telegram-btn w-full py-2 mb-2 transition duration-200 hover:opacity-80">Tahmin Et</button>
            <p id="guess-game-feedback" class="text-sm text-gray-400 mb-3"></p>
            <button id="guess-game-new-button" class="telegram-btn bg-gray-500 hover:bg-gray-600 w-full py-2 transition duration-200 hover:opacity-80 hidden">Yeni Oyun BaÅŸlat</button>
            <div id="message-box-guess-game-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- TaÅŸ, KaÄŸÄ±t, Makas ModalÄ± -->
    <div id="rps-game-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="rps-game-modal-close-btn" class="game-modal-close-btn">Ã—</button>
            <h2 class="text-xl font-bold mb-4">TaÅŸ, KaÄŸÄ±t, Makas!</h2>
            <p class="text-sm text-gray-600 mb-3">BilgisayarÄ± yen, 20 puan kazan!</p>
            <div id="rps-choices" class="flex justify-center gap-3 mb-4">
                <button id="rps-rock-btn" class="rps-btn telegram-btn">TaÅŸ</button>
                <button id="rps-paper-btn" class="rps-btn telegram-btn">KaÄŸÄ±t</button>
                <button id="rps-scissors-btn" class="rps-btn telegram-btn">Makas</button>
            </div>
            <div class="mb-3">
                Senin seÃ§imin: <span id="rps-player-choice-display" class="text-yellow-300"></span><br>
                BilgisayarÄ±n seÃ§imi: <span id="rps-computer-choice-display" class="text-yellow-300"></span>
            </div>
            <p id="rps-result-display-text" class="text-base text-white font-bold mb-3"></p>
            <button id="rps-play-again-button" class="telegram-btn bg-gray-500 hover:bg-gray-600 w-full py-2 transition duration-200 hover:opacity-80 hidden">Tekrar Oyna</button>
            <div id="message-box-rps-game-modal" class="message-box mt-4"></div>
        </div>
    </div>


    <script>
        // Firebase ve Uygulama AyarlarÄ±nÄ± Global DeÄŸiÅŸkenlerden AlÄ±n
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Kendi firebaseConfig'inizi buraya yapÄ±ÅŸtÄ±rÄ±n.
        const firebaseConfig = {
            apiKey: "AIzaSyBnktrT7Pp7WucJP_xtEu_mmQle_VthRAE",
            authDomain: "onwingiris-afccf.firebaseapp.com",
            projectId: "onwingiris-afccf",
            storageBucket: "onwingiris-afccf.firebasestorage.app",
            messagingSenderId: "1059998132611",
            appId: "1:1059998132611:web:7f415159c54936cc796eb6",
            measurementId: "G-RE79PDJSJX"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId, userDocRef;
        let isSpinning = false;
        
        // Bonus Ã§arkÄ± iÃ§in bÃ¶lÃ¼mler - Mor ve siyah tonlarÄ±nda gÃ¼ncellendi
        const segments = [
            { text: "10 TL Bonus", color: "#6f2da8", type: "bonus_code" }, // AÃ§Ä±k mor
            { text: "Tekrar Dene", color: "#1a1a1a", type: "try_again" }, // Siyah
            { text: "25 TL Bonus", color: "#8a2be2", type: "bonus_code" }, // Orta mor
            { text: "Tekrar Dene", color: "#2a0045", type: "try_again" }, // Koyu mor
            { text: "50 TL Bonus", color: "#b19cd9", type: "bonus_code" }, // Lavanta moru
            { text: "Tekrar Dene", color: "#3a005f", type: "try_again" }, // Ã‡ok koyu mor
            { text: "25 TL Bonus", color: "#c3aed6", type: "bonus_code" }, // Daha aÃ§Ä±k lavanta
            { text: "Tekrar Dene", color: "#1a1a1a", type: "try_again" }  // Siyah
        ];

        // HTML elemanlarÄ± (DOMContentLoaded iÃ§inde tanÄ±mlanacak)
        let loadingScreen, usernameModal, usernameInput, saveUsernameBtn;
        let appHeader, userInfoHeader, pointsDisplayHeader;
        let appWrapper, homePageContent, bonusCodesListSection, bonusCodesList;
        // Anasayfa oyun kartlarÄ±
        let wheelCard, fastClickCard, guessGameCard, rpsGameCard;

        // Modallar ve iÃ§indeki elemanlar
        let wheelModal, wheelModalCloseBtn, wheelElement, wheelSpinButton, messageBoxWheelModal; // wheelSpinButton olarak gÃ¼ncellendi
        let fastClickModal, fastClickModalCloseBtn, fastClickGameButton, messageBoxFastClickModal; // fastClickGameButton olarak gÃ¼ncellendi
        let guessGameModal, guessGameModalCloseBtn, guessGameInput, guessGameSubmitButton, guessGameFeedback, guessGameNewButton, messageBoxGuessGameModal; // unique ID'ler
        let rpsGameModal, rpsGameModalCloseBtn, rpsRockBtn, rpsPaperBtn, rpsScissorsBtn, rpsPlayerChoiceDisplay, rpsComputerChoiceDisplay, rpsResultDisplayText, rpsPlayAgainButton, messageBoxRpsGameModal; // unique ID'ler

        let messageBoxHome; // Anasayfa iÃ§in genel mesaj kutusu

        // SayÄ± Tahmin Oyunu DeÄŸiÅŸkenleri
        let targetNumber, attemptsLeft, gameOver;
        const MAX_ATTEMPTS = 7;
        const MIN_NUM = 1;
        const MAX_NUM = 100;
        const GUESS_GAME_WIN_POINTS = 50;

        // TaÅŸ-KaÄŸÄ±t-Makas Oyunu DeÄŸiÅŸkenleri
        const choices = ['taÅŸ', 'kaÄŸÄ±t', 'makas'];
        const RPS_GAME_WIN_POINTS = 20;

        // MODAL YÃ–NETÄ°MÄ° BAÅLANGIÃ‡
        function openModal(modalElement) {
            modalElement.style.display = 'flex'; // Ã–nce display'i ayarla
            setTimeout(() => { // GeÃ§iÅŸin tetiklenmesi iÃ§in kÄ±sa bir gecikme
                modalElement.classList.add('open');
            }, 10);
        }

        function closeModal(modalElement) {
            modalElement.classList.remove('open');
            modalElement.addEventListener('transitionend', function handler() {
                modalElement.style.display = 'none'; // GeÃ§iÅŸ bittikten sonra display'i gizle
                modalElement.removeEventListener('transitionend', handler); // Dinleyiciyi kaldÄ±r
            }, { once: true });
        }
        // MODAL YÃ–NETÄ°MÄ° BÄ°TÄ°Å

        // KullanÄ±cÄ±ya mesaj gÃ¶stermek iÃ§in Ã¶zel fonksiyon (hedef kutu ID'sine gÃ¶re)
        function showMessage(text, isError = false, targetBoxId = 'message-box-home') {
            let targetBox = document.getElementById(targetBoxId);
            if (!targetBox) {
                console.error(`Hata: ${targetBoxId} HTML elementi henÃ¼z bulunamadÄ±. Mesaj:`, text);
                return;
            }
            targetBox.textContent = text;
            if (isError) {
                targetBox.style.backgroundColor = '#dc3545'; // KÄ±rmÄ±zÄ± arka plan
            } else {
                targetBox.style.backgroundColor = '#333'; // VarsayÄ±lan arka plan
            }
            targetBox.style.display = 'block';
            setTimeout(() => {
                targetBox.style.display = 'none';
            }, 3000); // 3 saniye sonra gizle
        }

        // Ã‡arkÄ± dinamik olarak oluÅŸturma
        function createWheel() {
            const numSegments = segments.length;
            const segmentAngle = 360 / numSegments;
            
            if (wheelElement) wheelElement.innerHTML = ''; // Ã‡arkÄ± temizle
            
            segments.forEach((segmentData, index) => {
                const rotationAngle = index * segmentAngle; // Segmentin dÃ¶nme aÃ§Ä±sÄ±

                // Her bir dilim iÃ§in kapsayÄ±cÄ± div
                const segmentEl = document.createElement('div');
                segmentEl.className = 'segment';
                segmentEl.style.setProperty('--rotation-angle', `${rotationAngle}deg`);
                segmentEl.style.setProperty('--segment-color', segmentData.color);
                segmentEl.style.setProperty('--segment-sweep-angle', `${segmentAngle}deg`); // Dilim yay aÃ§Ä±sÄ±

                // Renkli kÄ±smÄ±n kendisi
                const colorFillEl = document.createElement('div');
                colorFillEl.className = 'segment-color-fill';
                segmentEl.appendChild(colorFillEl);

                // Segmentin iÃ§indeki metin etiketi
                const labelEl = document.createElement('div');
                labelEl.className = 'segment-label';
                labelEl.textContent = segmentData.text;
                // Metni yatay tutmak iÃ§in karÅŸÄ±t dÃ¶nÃ¼ÅŸ
                labelEl.style.setProperty('--rotation-angle', `${rotationAngle}deg`); 

                segmentEl.appendChild(labelEl);
                if (wheelElement) wheelElement.appendChild(segmentEl);
            });
        }

        // Firebase'i baÅŸlat ve kullanÄ±cÄ±yÄ± yetkilendir
        async function initializeFirebase() {
            try {
                // Firebase'i baÅŸlatma
                const app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth(); // compat versiyonunda bu ÅŸekilde
                db = firebase.firestore(); // compat versiyonunda bu ÅŸekilde

                // KullanÄ±cÄ± yetkilendirmesi
                if (initialAuthToken) {
                    await auth.signInWithCustomToken(initialAuthToken);
                } else {
                    await auth.signInAnonymously();
                }

                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        userId = user.uid;
                        // Firestore collection ve doc referanslarÄ±nÄ± dÃ¼zeltme
                        userDocRef = db.collection(`artifacts/${appId}/public/data/game_data`).doc(userId);
                        
                        // KullanÄ±cÄ± verilerini Firestore'dan al veya oluÅŸtur
                        const docSnap = await userDocRef.get();
                        
                        if (!docSnap.exists) {
                            // Yeni kullanÄ±cÄ±, varsayÄ±lan verileri ayarla
                            await userDocRef.set({
                                username: null, // KullanÄ±cÄ± adÄ± boÅŸ olarak baÅŸla
                                points: 0,
                                bonusCodes: [],
                                lastClick: 0
                            });
                            // KullanÄ±cÄ± adÄ± modalÄ±nÄ± gÃ¶ster
                            loadingScreen.style.display = 'none';
                            if (usernameModal) openModal(usernameModal);
                        } else {
                            const userData = docSnap.data();
                            if (!userData.username) {
                                // KullanÄ±cÄ± var ama kullanÄ±cÄ± adÄ± ayarlÄ± deÄŸil
                                loadingScreen.style.display = 'none';
                                if (usernameModal) openModal(usernameModal);
                            } else {
                                // KullanÄ±cÄ± adÄ± zaten ayarlÄ±, ana uygulamayÄ± gÃ¶ster
                                loadingScreen.style.display = 'none';
                                if (homePageContent) homePageContent.style.display = 'flex';
                                listenForDataChanges();
                            }
                        }
                    } else {
                        // EÄŸer kimlik doÄŸrulama baÅŸarÄ±sÄ±z olursa, bir hata mesajÄ± gÃ¶ster
                        console.error("Kimlik doÄŸrulama baÅŸarÄ±sÄ±z oldu, kullanÄ±cÄ± nesnesi boÅŸ.");
                        loadingScreen.style.display = 'none';
                        showMessage('Kimlik doÄŸrulama baÅŸarÄ±sÄ±z oldu, lÃ¼tfen uygulamayÄ± tekrar aÃ§Ä±n.', true, 'message-box-home');
                    }
                });
            } catch (error) {
                // Firebase baÅŸlatÄ±lÄ±rken veya kimlik doÄŸrulanÄ±rken oluÅŸan hatalarÄ± yakala
                console.error("Firebase baÅŸlatÄ±lÄ±rken bir hata oluÅŸtu:", error);
                loadingScreen.style.display = 'none';
                showMessage(`Uygulama baÅŸlatÄ±lÄ±rken bir hata oluÅŸtu: ${error.message}`, true, 'message-box-home');
            }
        }
        
        // Firestore'dan gerÃ§ek zamanlÄ± veri dinleme
        function listenForDataChanges() {
            userDocRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    updateUI(data);
                }
            });
        }
        
        // UI'Ä± verilerle gÃ¼ncelleme
        function updateUI(data) {
            // Header'daki puan ve kullanÄ±cÄ± adÄ±nÄ± gÃ¼ncelle
            if (pointsDisplayHeader) pointsDisplayHeader.textContent = `Puan: ${data.points}`;
            
            if (userInfoHeader) {
                if (data.username) {
                    userInfoHeader.textContent = `KullanÄ±cÄ±: ${data.username}`;
                } else {
                    userInfoHeader.textContent = `KullanÄ±cÄ± KimliÄŸi: ${userId}`;
                }
            }
            
            // Bonus kodlarÄ±nÄ± listele
            if (bonusCodesList) {
                bonusCodesList.innerHTML = '';
                if (data.bonusCodes && data.bonusCodes.length > 0) {
                    data.bonusCodes.forEach(code => {
                        const li = document.createElement('li');
                        li.textContent = `â€¢ ${code}`;
                        bonusCodesList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = "HenÃ¼z kazanÄ±lmÄ±ÅŸ bonus kodunuz yok.";
                    bonusCodesList.appendChild(li);
                }
            }

            // Ã‡arkÄ± Ã§evir butonunu etkinleÅŸtirme
            if (wheelSpinButton) wheelSpinButton.disabled = data.points < 100 || isSpinning;
        }

        // KullanÄ±cÄ± adÄ±nÄ± kaydetme fonksiyonu
        async function saveUsername() {
            console.log("saveUsername Ã§aÄŸrÄ±ldÄ±.");
            const username = usernameInput.value.trim();
            if (username.length < 3 || username.length > 20) {
                showMessage("KullanÄ±cÄ± adÄ± 3 ile 20 karakter arasÄ±nda olmalÄ±dÄ±r.", true, 'message-box-home');
                console.log("KullanÄ±cÄ± adÄ± doÄŸrulama baÅŸarÄ±sÄ±z.");
                return;
            }
            console.log("KullanÄ±cÄ± adÄ± doÄŸrulama baÅŸarÄ±lÄ±:", username);

            try {
                // KullanÄ±cÄ± adÄ±nÄ±n benzersizliÄŸini kontrol et (ve mevcut kullanÄ±cÄ±nÄ±n kendi adÄ± olup olmadÄ±ÄŸÄ±nÄ±)
                const usernameQuery = await db.collection(`artifacts/${appId}/public/data/game_data`).where('username', '==', username).get();
                
                if (!usernameQuery.empty) {
                    // Bu kullanÄ±cÄ± adÄ±nÄ± kullanan bir belge bulundu
                    const existingUserDoc = usernameQuery.docs[0];
                    if (existingUserDoc.id !== userId) {
                        // EÄŸer bu kullanÄ±cÄ± adÄ± baÅŸka bir kullanÄ±cÄ±ya aitse
                        showMessage("Bu kullanÄ±cÄ± adÄ± zaten alÄ±nmÄ±ÅŸ, lÃ¼tfen baÅŸka bir tane dene.", true, 'message-box-home');
                        console.log("KullanÄ±cÄ± adÄ± baÅŸka bir kullanÄ±cÄ± tarafÄ±ndan alÄ±nmÄ±ÅŸ.");
                        return;
                    }
                    // EÄŸer bu kullanÄ±cÄ± adÄ± mevcut kullanÄ±cÄ±nÄ±n kendisiyse, devam et.
                    console.log("KullanÄ±cÄ± adÄ± mevcut kullanÄ±cÄ±nÄ±n kendi adÄ±.");
                }
                console.log("KullanÄ±cÄ± adÄ± benzersizlik kontrolÃ¼ baÅŸarÄ±lÄ± veya mevcut kullanÄ±cÄ±ya ait.");

                await userDocRef.update({ username: username });
                console.log("Firestore'a kullanÄ±cÄ± adÄ± baÅŸarÄ±yla gÃ¼ncellendi.");

                // UI elementlerinin varlÄ±ÄŸÄ±nÄ± kontrol et
                if (usernameModal && homePageContent) {
                    closeModal(usernameModal);
                    homePageContent.style.display = 'flex'; // 'block' yerine 'flex'
                    console.log("UI gÃ¼ncellendi: usernameModal gizlendi, homePageContent gÃ¶sterildi.");
                } else {
                    console.error("Hata: usernameModal veya homePageContent bulunamadÄ±. UI gÃ¼ncellenemedi.");
                    showMessage("Uygulama arayÃ¼zÃ¼ gÃ¼ncellenemedi, lÃ¼tfen tekrar deneyin.", true, 'message-box-home');
                }

                showMessage(`HoÅŸ geldin, ${username}!`, false, 'message-box-home');
                listenForDataChanges(); // KullanÄ±cÄ± adÄ± kaydedildikten sonra UI'Ä± gÃ¼ncelle
            } catch (e) {
                console.error("KullanÄ±cÄ± adÄ± kaydedilirken hata oluÅŸtu: ", e);
                showMessage("KullanÄ±cÄ± adÄ± kaydedilirken bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin. Detay: " + e.message, true, 'message-box-home');
            }
        }

        // SayÄ± Tahmin Oyunu MantÄ±ÄŸÄ±
        function startGame() {
            targetNumber = Math.floor(Math.random() * (MAX_NUM - MIN_NUM + 1)) + MIN_NUM;
            attemptsLeft = MAX_ATTEMPTS;
            gameOver = false;
            if (guessGameInput) guessGameInput.value = '';
            if (guessGameInput) guessGameInput.disabled = false;
            if (guessGameSubmitButton) guessGameSubmitButton.disabled = false;
            if (guessGameNewButton) guessGameNewButton.classList.add('hidden');
            updateGuessFeedback(`Kalan tahmin hakkÄ±: ${attemptsLeft}`, false); // Modala Ã¶zel mesaj kutusu yok, genel kullanacak
        }

        function updateGuessFeedback(message, isError = false) {
            if (guessGameFeedback) {
                guessGameFeedback.textContent = message;
                guessGameFeedback.style.color = isError ? '#dc3545' : '#ffffff';
            }
        }

        async function checkGuess() {
            if (gameOver) return;

            const guess = parseInt(guessGameInput.value);

            if (isNaN(guess) || guess < MIN_NUM || guess > MAX_NUM) {
                updateGuessFeedback(`LÃ¼tfen ${MIN_NUM} ile ${MAX_NUM} arasÄ±nda geÃ§erli bir sayÄ± girin.`, true);
                return;
            }

            attemptsLeft--;

            if (guess === targetNumber) {
                updateGuessFeedback(`Tebrikler! SayÄ±yÄ± ${MAX_ATTEMPTS - attemptsLeft} tahminde buldun! (+${GUESS_GAME_WIN_POINTS} Puan)`, false);
                gameOver = true;
                if (guessGameInput) guessGameInput.disabled = true;
                if (guessGameSubmitButton) guessGameSubmitButton.disabled = true;
                if (guessGameNewButton) guessGameNewButton.classList.remove('hidden');
                
                // PuanÄ± Firestore'a kaydet
                try {
                    const docSnap = await userDocRef.get();
                    await userDocRef.update({
                        points: (docSnap.data().points || 0) + GUESS_GAME_WIN_POINTS
                    });
                    showMessage(`${GUESS_GAME_WIN_POINTS} puan kazandÄ±n!`, false, 'message-box-guess-game-modal');
                } catch (e) {
                    console.error("Puan gÃ¼ncellenirken hata oluÅŸtu: ", e);
                    showMessage("Puan kaydedilirken bir hata oluÅŸtu.", true, 'message-box-guess-game-modal');
                }

            } else if (attemptsLeft === 0) {
                updateGuessFeedback(`ÃœzgÃ¼nÃ¼m, tahmin hakkÄ±n kalmadÄ±! SayÄ± ${targetNumber} idi.`, true);
                gameOver = true;
                if (guessGameInput) guessGameInput.disabled = true;
                if (guessGameSubmitButton) guessGameSubmitButton.disabled = true;
                if (guessGameNewButton) guessGameNewButton.classList.remove('hidden');
            } else {
                const hint = guess < targetNumber ? 'daha yÃ¼ksek' : 'daha dÃ¼ÅŸÃ¼k';
                updateGuessFeedback(`YanlÄ±ÅŸ! SayÄ± ${hint}. Kalan tahmin hakkÄ±: ${attemptsLeft}`);
            }
            if (guessGameInput) guessGameInput.value = ''; // Tahmin kutusunu temizle
        }

        // TaÅŸ-KaÄŸÄ±t-Makas Oyunu MantÄ±ÄŸÄ±
        function initializeRPSGame() {
            if (rpsPlayerChoiceDisplay) rpsPlayerChoiceDisplay.textContent = '';
            if (rpsComputerChoiceDisplay) rpsComputerChoiceDisplay.textContent = '';
            if (rpsResultDisplayText) rpsResultDisplayText.textContent = 'Bir seÃ§im yap!';
            if (rpsRockBtn) rpsRockBtn.disabled = false;
            if (rpsPaperBtn) rpsPaperBtn.disabled = false;
            if (rpsScissorsBtn) rpsScissorsBtn.disabled = false;
            if (rpsPlayAgainButton) rpsPlayAgainButton.classList.add('hidden');
            if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#ffffff'; // VarsayÄ±lan renk
        }

        async function playRPSGame(playerChoice) {
            if (!userId) {
                showMessage("KullanÄ±cÄ± verisi yÃ¼kleniyor, lÃ¼tfen bekleyin.", true, 'message-box-rps-game-modal');
                return;
            }

            // SeÃ§im butonlarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak
            if (rpsRockBtn) rpsRockBtn.disabled = true;
            if (rpsPaperBtn) rpsPaperBtn.disabled = true;
            if (rpsScissorsBtn) rpsScissorsBtn.disabled = true;

            const computerChoice = choices[Math.floor(Math.random() * choices.length)];

            if (rpsPlayerChoiceDisplay) rpsPlayerChoiceDisplay.textContent = playerChoice.charAt(0).toUpperCase() + playerChoice.slice(1);
            if (rpsComputerChoiceDisplay) rpsComputerChoiceDisplay.textContent = computerChoice.charAt(0).toUpperCase() + computerChoice.slice(1);

            let result;
            let isWin = false;

            if (playerChoice === computerChoice) {
                result = 'Berabere!';
            } else if (
                (playerChoice === 'taÅŸ' && computerChoice === 'makas') ||
                (playerChoice === 'kaÄŸÄ±t' && computerChoice === 'taÅŸ') ||
                (playerChoice === 'makas' && computerChoice === 'kaÄŸÄ±t')
            ) {
                result = 'KazandÄ±n! (+20 Puan)';
                isWin = true;
            } else {
                result = 'Kaybettin.';
            }

            if (rpsResultDisplayText) rpsResultDisplayText.textContent = result;
            if (isWin) {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#a78bfa'; // Mor renk
                try {
                    const docSnap = await userDocRef.get();
                    await userDocRef.update({
                        points: (docSnap.data().points || 0) + RPS_GAME_WIN_POINTS
                    });
                    showMessage(`${RPS_GAME_WIN_POINTS} puan kazandÄ±n!`, false, 'message-box-rps-game-modal');
                } catch (e) {
                    console.error("RPS puanÄ± gÃ¼ncellenirken hata oluÅŸtu: ", e);
                    showMessage("Puan kaydedilirken bir hata oluÅŸtu.", true, 'message-box-rps-game-modal');
                }
            } else if (result === 'Berabere!') {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#fcd34d'; // SarÄ±msÄ±
            } else {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#dc3545'; // KÄ±rmÄ±zÄ±
            }
            
            if (rpsPlayAgainButton) rpsPlayAgainButton.classList.remove('hidden');
        }


        // Uygulama yÃ¼klendiÄŸinde baÅŸlat
        document.addEventListener('DOMContentLoaded', () => { 
            // HTML elemanlarÄ±nÄ± DOM yÃ¼klendikten sonra al ve global deÄŸiÅŸkenlere ata
            loadingScreen = document.getElementById('loading-screen');
            usernameModal = document.getElementById('username-modal');
            usernameInput = document.getElementById('username-input');
            saveUsernameBtn = document.getElementById('save-username-btn');

            appHeader = document.getElementById('app-header');
            userInfoHeader = document.getElementById('user-info-header');
            pointsDisplayHeader = document.getElementById('points-display-header');

            appWrapper = document.getElementById('app-wrapper');
            homePageContent = document.getElementById('home-page-content');
            bonusCodesListSection = document.getElementById('bonus-codes-list-section');
            bonusCodesList = document.getElementById('bonus-codes-list');
            messageBoxHome = document.getElementById('message-box-home');

            // Anasayfa oyun kartlarÄ±
            wheelCard = document.getElementById('wheel-card');
            fastClickCard = document.getElementById('fast-click-card');
            guessGameCard = document.getElementById('guess-game-card');
            rpsGameCard = document.getElementById('rps-game-card');

            // Modallar ve iÃ§indeki elemanlar
            wheelModal = document.getElementById('wheel-modal');
            wheelModalCloseBtn = document.getElementById('wheel-modal-close-btn');
            wheelElement = document.getElementById('wheel-element'); // Ã‡arkÄ±n kendisi ID'si gÃ¼ncellendi
            wheelSpinButton = document.getElementById('wheel-spin-button'); // ID gÃ¼ncellendi
            messageBoxWheelModal = document.getElementById('message-box-wheel-modal');

            fastClickModal = document.getElementById('fast-click-modal');
            fastClickModalCloseBtn = document.getElementById('fast-click-modal-close-btn');
            fastClickGameButton = document.getElementById('fast-click-game-button'); // ID gÃ¼ncellendi
            messageBoxFastClickModal = document.getElementById('message-box-fast-click-modal');

            guessGameModal = document.getElementById('guess-game-modal');
            guessGameModalCloseBtn = document.getElementById('guess-game-modal-close-btn');
            guessGameInput = document.getElementById('guess-game-input'); // ID gÃ¼ncellendi
            guessGameSubmitButton = document.getElementById('guess-game-submit-button'); // ID gÃ¼ncellendi
            guessGameFeedback = document.getElementById('guess-game-feedback'); // ID gÃ¼ncellendi
            guessGameNewButton = document.getElementById('guess-game-new-button'); // ID gÃ¼ncellendi
            messageBoxGuessGameModal = document.getElementById('message-box-guess-game-modal');

            rpsGameModal = document.getElementById('rps-game-modal');
            rpsGameModalCloseBtn = document.getElementById('rps-game-modal-close-btn');
            rpsRockBtn = document.getElementById('rps-rock-btn'); // ID gÃ¼ncellendi
            rpsPaperBtn = document.getElementById('rps-paper-btn'); // ID gÃ¼ncellendi
            rpsScissorsBtn = document.getElementById('rps-scissors-btn'); // ID gÃ¼ncellendi
            rpsPlayerChoiceDisplay = document.getElementById('rps-player-choice-display'); // ID gÃ¼ncellendi
            rpsComputerChoiceDisplay = document.getElementById('rps-computer-choice-display'); // ID gÃ¼ncellendi
            rpsResultDisplayText = document.getElementById('rps-result-display-text'); // ID gÃ¼ncellendi
            rpsPlayAgainButton = document.getElementById('rps-play-again-button'); // ID gÃ¼ncellendi
            messageBoxRpsGameModal = document.getElementById('message-box-rps-game-modal');


            // KullanÄ±cÄ± adÄ± kaydetme butonu iÃ§in olay dinleyici
            if (saveUsernameBtn) {
                saveUsernameBtn.addEventListener('click', saveUsername);
            } else {
                console.error("Hata: saveUsernameBtn HTML elementi bulunamadÄ±!");
                showMessage("Uygulama yÃ¼klenirken bir sorun oluÅŸtu (KullanÄ±cÄ± AdÄ± Kaydet Butonu bulunamadÄ±).", true, 'message-box-home');
            }

            // HÄ±zlÄ± TÄ±kla! kartÄ±na tÄ±klama olayÄ± (modalÄ± aÃ§ar)
            if (fastClickCard) {
                fastClickCard.addEventListener('click', () => {
                    if (fastClickModal) openModal(fastClickModal);
                });
            }
            // HÄ±zlÄ± TÄ±kla! modalÄ±ndaki kapatma butonu
            if (fastClickModalCloseBtn) {
                fastClickModalCloseBtn.addEventListener('click', () => {
                    if (fastClickModal) closeModal(fastClickModal);
                });
            }

            // SayÄ± Tahmin Oyunu kartÄ±na tÄ±klama olayÄ± (modalÄ± aÃ§ar)
            if (guessGameCard) {
                guessGameCard.addEventListener('click', () => {
                    if (guessGameModal) openModal(guessGameModal);
                    startGame(); // ModalÄ± aÃ§tÄ±ÄŸÄ±nda oyunu baÅŸlat
                });
            }
            // SayÄ± Tahmin Oyunu modalÄ±ndaki kapatma butonu
            if (guessGameModalCloseBtn) {
                guessGameModalCloseBtn.addEventListener('click', () => {
                    if (guessGameModal) closeModal(guessGameModal);
                });
            }

            // TaÅŸ, KaÄŸÄ±t, Makas kartÄ±na tÄ±klama olayÄ± (modalÄ± aÃ§ar)
            if (rpsGameCard) {
                rpsGameCard.addEventListener('click', () => {
                    if (rpsGameModal) openModal(rpsGameModal);
                    initializeRPSGame(); // ModalÄ± aÃ§tÄ±ÄŸÄ±nda oyunu baÅŸlat
                });
            }
            // TaÅŸ, KaÄŸÄ±t, Makas modalÄ±ndaki kapatma butonu
            if (rpsGameModalCloseBtn) {
                rpsGameModalCloseBtn.addEventListener('click', () => {
                    if (rpsGameModal) closeModal(rpsGameModal);
                });
            }

            // HÄ±zlÄ± TÄ±kla! butonu iÃ§in olay dinleyici (modal iÃ§inde)
            if (fastClickGameButton) { 
                fastClickGameButton.addEventListener('click', async () => {
                    if (!userId) {
                        showMessage("KullanÄ±cÄ± verisi yÃ¼kleniyor, lÃ¼tfen bekleyin.", true, 'message-box-fast-click-modal');
                        return;
                    }

                    const now = Date.now();
                    const docSnap = await userDocRef.get();
                    if (docSnap.exists) {
                        const lastClick = docSnap.data().lastClick || 0;
                        if (now - lastClick < 500) { 
                            showMessage("Ã‡ok hÄ±zlÄ±sÄ±n! LÃ¼tfen biraz bekle.", false, 'message-box-fast-click-modal');
                            return;
                        }
                    }

                    try {
                        await userDocRef.update({
                            points: (docSnap.data().points || 0) + 10,
                            lastClick: now
                        });
                        showMessage("Puan kazandÄ±n!", false, 'message-box-fast-click-modal');
                    } catch (e) {
                        console.error("Puan gÃ¼ncellenirken hata oluÅŸtu: ", e);
                        showMessage("Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.", true, 'message-box-fast-click-modal');
                    }
                });
            } else {
                console.error("Hata: fastClickGameButton HTML elementi bulunamadÄ±!");
                showMessage("Uygulama yÃ¼klenirken bir sorun oluÅŸtu (Oyun Butonu bulunamadÄ±).", true, 'message-box-home');
            }

            // Ã‡arkÄ±felek kartÄ±na tÄ±klama olayÄ± (modalÄ± aÃ§ar)
            if (wheelCard) {
                wheelCard.addEventListener('click', () => {
                    if (wheelModal) openModal(wheelModal);
                });
            } else {
                console.error("Hata: wheelCard HTML elementi bulunamadÄ±!");
            }

            // Ã‡ark modalÄ±ndaki kapatma butonu
            if (wheelModalCloseBtn) {
                wheelModalCloseBtn.addEventListener('click', () => {
                    if (wheelModal) closeModal(wheelModal);
                });
            } else {
                console.error("Hata: wheelModalCloseBtn HTML elementi bulunamadÄ±!");
            }

            // Ã‡arkÄ± Ã§evir butonu (modal iÃ§inde)
            if (wheelSpinButton) { // ID gÃ¼ncellendi
                wheelSpinButton.addEventListener('click', async () => {
                    if (!userId) return;
                    isSpinning = true;
                    wheelSpinButton.disabled = true;
                    wheelSpinButton.textContent = "Ã‡evriliyor...";

                    try {
                        const docSnap = await userDocRef.get();
                        const currentPoints = docSnap.data().points || 0;

                        if (currentPoints < 100) {
                            showMessage("Yeterli puanÄ±n yok!", true, 'message-box-wheel-modal');
                            isSpinning = false;
                            wheelSpinButton.disabled = false;
                            wheelSpinButton.textContent = "Ã‡arkÄ± Ã‡evir (100 Puan)";
                            return;
                        }

                        await userDocRef.update({
                            points: currentPoints - 100
                        });

                        const targetSegmentIndex = Math.floor(Math.random() * segments.length);
                        const segmentAngle = 360 / segments.length;
                        const totalAngle = 360 * 5 + (360 - (targetSegmentIndex * segmentAngle + segmentAngle / 2));
                        
                        wheelElement.style.transform = `rotate(${totalAngle}deg)`;
                        
                        setTimeout(async () => {
                            const result = segments[targetSegmentIndex];
                            if (result.type === 'bonus_code') {
                                const newBonusCode = `BONUS-${Math.random().toString(36).substring(2, 10).toUpperCase()}`;
                                await userDocRef.update({
                                    bonusCodes: firebase.firestore.FieldValue.arrayUnion(newBonusCode)
                                });
                                showMessage(`Tebrikler! ${result.text} kazandÄ±n. Kodun: ${newBonusCode}`, false, 'message-box-wheel-modal');
                            } else {
                                showMessage("Maalesef, bir dahaki sefere!", false, 'message-box-wheel-modal');
                            }
                            
                            isSpinning = false;
                            wheelSpinButton.disabled = false;
                            wheelSpinButton.textContent = "Ã‡arkÄ± Ã‡evir (100 Puan)";
                            wheelElement.style.transform = 'rotate(0deg)'; // Ã‡arkÄ± baÅŸlangÄ±Ã§ konumuna dÃ¶ndÃ¼r
                        }, 5000); // 5 saniye animasyon sÃ¼resi
                    } catch (e) {
                        console.error("Ã‡ark Ã§evrilirken bir hata oluÅŸtu: ", e);
                        showMessage("Bir hata oluÅŸtu, lÃ¼tfen tekrar deneyin.", true, 'message-box-wheel-modal');
                        isSpinning = false;
                        wheelSpinButton.disabled = false;
                        wheelSpinButton.textContent = "Ã‡arkÄ± Ã‡evir (100 Puan)";
                    }
                });
            } else {
                console.error("Hata: wheelSpinButton HTML elementi bulunamadÄ±!");
                showMessage("Uygulama yÃ¼klenirken bir sorun oluÅŸtu (Ã‡ark Butonu bulunamadÄ±).", true, 'message-box-home');
            }
            
            // createWheel Ã§aÄŸrÄ±sÄ± wheelElement atandÄ±ktan sonra yapÄ±lmalÄ±
            if (wheelElement) {
                createWheel(); 
            } else {
                console.error("Hata: wheelElement HTML elementi bulunamadÄ±!");
            }

            // SayÄ± Tahmin Oyunu Olay Dinleyicileri (modal iÃ§inde)
            if (guessGameSubmitButton) {
                guessGameSubmitButton.addEventListener('click', checkGuess);
            }
            if (guessGameNewButton) {
                guessGameNewButton.addEventListener('click', startGame);
            }
            
            // TaÅŸ-KaÄŸÄ±t-Makas Oyunu Olay Dinleyicileri (modal iÃ§inde)
            if (rpsRockBtn) rpsRockBtn.addEventListener('click', () => playRPSGame('taÅŸ'));
            if (rpsPaperBtn) rpsPaperBtn.addEventListener('click', () => playRPSGame('kaÄŸÄ±t'));
            if (rpsScissorsBtn) rpsScissorsBtn.addEventListener('click', () => playRPSGame('makas'));
            if (rpsPlayAgainButton) rpsPlayAgainButton.addEventListener('click', initializeRPSGame);
            
            initializeFirebase();
        });
    </script>
</body>
</html>
