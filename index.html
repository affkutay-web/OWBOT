<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Mini Uygulaması</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --card-color: #2b2b2b;
            --text-color: #f5f5f5;
            --accent-color: #9b59b6; /* Koyu mor */
            --accent-light: #c085e8;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
            box-sizing: border-box;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .container {
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-top: 20px;
            opacity: 0;
            animation: fadeIn 0.8s forwards;
        }
        
        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .card {
            background-color: var(--card-color);
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .profile-header {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            text-align: center;
        }
        
        .profile-info {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .profile-icon {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background-color: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 700;
            color: var(--text-color);
            text-transform: uppercase;
        }
        
        .username {
            font-size: 28px;
            font-weight: 700;
            margin: 0;
            color: var(--accent-light);
        }

        .user-id {
            color: #b0b0b0;
            font-size: 16px;
            margin: 4px 0 0;
        }
        
        .user-score {
            font-size: 18px;
            font-weight: 600;
            color: #4CAF50; /* Yeşil renk */
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .user-score::before {
            content: '⭐';
        }

        .content-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h2 {
            font-size: 20px;
            font-weight: 600;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 8px;
            margin-top: 0;
        }

        /* FAQ Stil Kodları */
        .faq-item {
            border-bottom: 1px solid #3a3a3a;
            padding: 15px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .faq-item:last-child {
            border-bottom: none;
        }

        .faq-question {
            font-weight: 600;
            font-size: 16px;
            color: var(--accent-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .faq-question::after {
            content: '+';
            font-size: 24px;
            transition: transform 0.3s ease;
        }
        
        .faq-item.active .faq-question::after {
            content: '-';
            transform: rotate(180deg);
        }

        .faq-answer {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
            color: #b0b0b0;
            font-size: 14px;
            padding-top: 0;
        }
        
        .faq-item.active .faq-answer {
            max-height: 200px;
            padding-top: 15px;
        }

        /* Çark Stil Kodları */
        .wheel-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            margin: 20px 0;
        }

        #wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 5px solid var(--accent-color);
            position: relative;
            overflow: hidden;
            transition: transform 5s cubic-bezier(0.25, 0.1, 0.25, 1);
            background: conic-gradient(
                #FFC107 0% 8.33%,
                #F44336 8.33% 16.66%,
                #E91E63 16.66% 25%,
                #9C27B0 25% 33.33%,
                #673AB7 33.33% 41.66%,
                #3F51B5 41.66% 50%,
                #2196F3 50% 58.33%,
                #03A9F4 58.33% 66.66%,
                #00BCD4 66.66% 75%,
                #009688 75% 83.33%,
                #4CAF50 83.33% 91.66%,
                #8BC34A 91.66% 100%
            );
            box-shadow: inset 0 0 15px rgba(0,0,0,0.5), 0 0 20px var(--accent-color);
        }

        .segment-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: 0% 0%;
            width: 50%;
            height: 50%;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            color: var(--text-color);
            font-size: 11px;
            font-weight: bold;
            text-align: left;
            padding-left: 10px;
            box-sizing: border-box;
            white-space: nowrap;
        }
        
        .segment-text:nth-child(1) { transform: rotate(15deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(2) { transform: rotate(45deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(3) { transform: rotate(75deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(4) { transform: rotate(105deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(5) { transform: rotate(135deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(6) { transform: rotate(165deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(7) { transform: rotate(195deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(8) { transform: rotate(225deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(9) { transform: rotate(255deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(10) { transform: rotate(285deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(11) { transform: rotate(315deg) translateY(-50%) translateX(-100%); }
        .segment-text:nth-child(12) { transform: rotate(345deg) translateY(-50%) translateX(-100%); }
        
        .pointer {
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid var(--accent-light);
            position: absolute;
            top: -10px;
            z-index: 10;
        }
        
        #spinBtn {
            margin-top: 20px;
            padding: 12px 24px;
            background-color: var(--accent-color);
            color: var(--text-color);
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }

        #spinBtn:hover:not(:disabled) {
            background-color: var(--accent-light);
            transform: translateY(-2px);
        }

        #spinBtn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
        }
        
        #prizeMessage {
            margin-top: 15px;
            font-size: 18px;
            font-weight: 600;
            color: var(--accent-light);
            text-align: center;
            min-height: 25px;
        }

        #countdown {
            margin-top: 10px;
            font-size: 14px;
            color: #b0b0b0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card profile-header">
            <div class="profile-info">
                <div id="profileIcon" class="profile-icon">?</div>
                <h1 class="username" id="username">Yükleniyor...</h1>
            </div>
            <p class="user-id" id="userId"></p>
            <p class="user-score" id="userScore">0 Puan</p>
        </div>

        <div class="card content-section">
            <h2>Günlük Bonus Çarkı</h2>
            <div class="wheel-container">
                <div id="wheel">
                    <div class="segment-text" data-prize="5 Puan"><span>5 Puan</span></div>
                    <div class="segment-text" data-prize="10 Puan"><span>10 Puan</span></div>
                    <div class="segment-text" data-prize="20 Puan"><span>20 Puan</span></div>
                    <div class="segment-text" data-prize="50 Puan"><span>50 Puan</span></div>
                    <div class="segment-text" data-prize="100 Puan"><span>100 Puan</span></div>
                    <div class="segment-text" data-prize="200 Puan"><span>200 Puan</span></div>
                    <div class="segment-text" data-prize="Ekstra Çevirme"><span>Ekstra Çevirme</span></div>
                    <div class="segment-text" data-prize="30 Puan"><span>30 Puan</span></div>
                    <div class="segment-text" data-prize="Kaybettin"><span>Kaybettin</span></div>
                    <div class="segment-text" data-prize="75 Puan"><span>75 Puan</span></div>
                    <div class="segment-text" data-prize="150 Puan"><span>150 Puan</span></div>
                    <div class="segment-text" data-prize="Şanslısın!"><span>Şanslısın!</span></div>
                </div>
                <div class="pointer"></div>
            </div>
            <button id="spinBtn">Çarkı Çevir</button>
            <div id="prizeMessage"></div>
            <div id="countdown"></div>
        </div>

        <div class="card content-section">
            <h2>Sıkça Sorulan Sorular</h2>
 <div id="faqContainer">
                <div class="faq-item">
                    <div class="faq-question">Nasıl Hesap Açabilirim?</div>
                    <div class="faq-answer">
                        Üye Ol [Kayıt] butonuna tıkladığınızda çıkan kayıt formunu doldurarak kolayca hesap oluşturabilirsiniz. Kayıt sırasında girdiğiniz e-posta adresinizi doğrulamanız gerekmektedir. Adresinizi doğruladığınızda kayıt işlemi de tamamlanacaktır.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Neden Hesap Açamıyorum?</div>
                    <div class="faq-answer">
                        Daha önce adınıza, e-posta adresinize, telefonunuza, adres bilgilerinize veya IP bilgilerinize kayıtlı bir hesabınız varsa, sistem yeni bir hesap oluşturmanıza izin vermeyecektir. Bu durumda bilgilerinizle birlikte ve sorunu anlatan bir e-posta göndererek müşteri hizmetleri temsilcilerimizden yardım alabilirsiniz.
                    </div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">Botu kullanmak güvenli mi?</div>
                    <div class="faq-answer">
                        Evet, botumuz kişisel bilgilerinizi korumak için tasarlanmıştır. Bot, size sadece güncel fırsatları sunar ve kişisel banka bilgilerinize erişemez.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">ONWIN’e kayıt olmakla herhangi bir yükümlülük üstleniyor muyum?</div>
                    <div class="faq-answer">
                        Hayır. Siteye kaydınız tamamen bağlayıcılıktan uzaktır ve düzenli olarak para yatırmak veya bahis oynamak mecburiyetiniz yoktur. Bununla birlikte kayıt olmak suretiyle Genel Şirket Şartnamemizi kabul etmiş olursunuz.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Hesabımı Tamamen Nasıl Kapatabilirim?</div>
                    <div class="faq-answer">
                       Üyelikten ayrılmanızı istemeyiz fakat hesabınızı kapatmak isterseniz yapmanız gereken, kapatma talebinizi nedeniyle birlikte e-posta olarak iletmeniz. En kısa sürede size dönüş yapılarak hesap kapatma işlemi gerçekleştirilecektir.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Şifremi Unuttum, Ne Yapmalıyım?</div>
                    <div class="faq-answer">
                        Şifrenizi unuttuysanız üst menüde en sağda yer alan soru işaretine tıklayarak yeni bir şifre talep edebilirsiniz. Bu işlem için e-posta adresinizi veya cep telefonu numaranızı kullanabilirsiniz. Ardından geçici bir şifre kayıtlı e-posta adresinize gönderilir.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Bonusu nasıl çekebilirim?</div>
                    <div class="faq-answer">
                        Verilen bonus tutarının çekilebilmesi için belirli koşulları yerine getirmeniz gereklidir. Bonusun türüne bağlı olarak kazancınızı veya bahis koşullarını yerine getirerek bonus için hesabınıza yatırdığınız tutarı çekebilirsiniz.
Bonuslar, kampanya kural ve şartlarına bağlı olarak bazen oyun oynandıktan önce (çekilmesi kısıtlı bonuslar), bazende oyunlara katıldıktan ve bahis koşulları tümüyle yerine getirildikten sonra oyuncuların hesaplarına işlenir.
                    </div>
                </div>

                <div class="faq-item">
                    <div class="faq-question">Hesabımı doğrulamak zorundamıyım?</div>
                    <div class="faq-answer">
                        Çevrimiçi oyun kuralları uyarınca, yaşı uygun olmayan kişilerin sitemizde oynamadıklarından emin olmak için kimliğinizi ve yaşınızı doğrulamak zorundayız.
                    </div>
                </div>
                
                <div class="faq-item">
                    <div class="faq-question">Birden fazla hesap açabilir miyim?</div>
                    <div class="faq-answer">
                        Sitemizde aynı isim, adres, telefon, e-posta ve IP adresine bağlı ikinci bir hesap oluşturamazsınız. Böyle bir durumda güvenlik birimlerimiz bunu tespit ederek mevcut hesabınız da dahil olmak üzere tüm hesapları kapatacak ve yeni hesap oluşturmanıza izin vermeyecektir.
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        // Firebase yapılandırma kodlarınızı buraya yapıştırın.
        const firebaseConfig = {
  apiKey: "AIzaSyBnktrT7Pp7WucJP_xtEu_mmQle_VthRAE",
  authDomain: "onwingiris-afccf.firebaseapp.com",
  projectId: "onwingiris-afccf",
  storageBucket: "onwingiris-afccf.firebasestorage.app",
  messagingSenderId: "1059998132611",
  appId: "1:1059998132611:web:2fa0e9b46c55d602796eb6",
  measurementId: "G-4SMQRV8R0N"
};
        firebase.initializeApp(firebaseConfig);

        const db = firebase.database();
        const MINUTES_IN_A_DAY = 24 * 60 * 60 * 1000;

        window.addEventListener('load', () => {
            const WebApp = window.Telegram.WebApp;
            WebApp.ready();

            const user = WebApp.initDataUnsafe.user;
            const profileIconElement = document.getElementById('profileIcon');
            const usernameElement = document.getElementById('username');
            const userIdElement = document.getElementById('userId');
            const userScoreElement = document.getElementById('userScore');
            const wheel = document.getElementById('wheel');
            const spinBtn = document.getElementById('spinBtn');
            const prizeMessage = document.getElementById('prizeMessage');
            const countdownElement = document.getElementById('countdown');

            // Kullanıcı bilgileri
            if (user) {
                const userName = user.first_name || 'Kullanıcı';
                const userId = user.id;

                usernameElement.textContent = userName;
                userIdElement.textContent = `@${user.username || 'Kullanıcı ID: ' + userId}`;
                
                if (userName) {
                    profileIconElement.textContent = userName.charAt(0).toUpperCase();
                }

                const userRef = db.ref('users/' + userId);
                const spinRef = db.ref('spins/' + userId);
                const scoreRef = db.ref('scores/' + userId);
                
                // Kullanıcı verisini ve puanını yükle
                userRef.update({
                    firstName: user.first_name,
                    lastName: user.last_name || null,
                    username: user.username || null,
                    lastLogin: firebase.database.ServerValue.TIMESTAMP
                });
                
                scoreRef.once('value').then(snapshot => {
                    const currentScore = snapshot.val() || 0;
                    userScoreElement.textContent = `${currentScore} Puan`;
                });

                // Firebase'den son çevirme zamanını kontrol et
                spinRef.once('value').then((snapshot) => {
                    const lastSpinTimestamp = snapshot.val();
                    const now = new Date().getTime();

                    if (lastSpinTimestamp && (now - lastSpinTimestamp) < MINUTES_IN_A_DAY) {
                        spinBtn.disabled = true;
                        prizeMessage.textContent = 'Günlük hakkınız bitti.';
                        updateCountdown(lastSpinTimestamp);
                    } else {
                        spinBtn.disabled = false;
                        prizeMessage.textContent = 'Hemen çevir ve kazan!';
                    }
                });
            } else {
                usernameElement.textContent = 'Gizli Kullanıcı';
                userIdElement.textContent = '';
                profileIconElement.textContent = '?';
            }

            // FAQ Açılır-Kapanır İşlevselliği
            const faqItems = document.querySelectorAll('.faq-item');
            faqItems.forEach(item => {
                item.addEventListener('click', () => {
                    item.classList.toggle('active');
                });
            });

            // Geri sayım sayacını güncelleyen fonksiyon
            function updateCountdown(lastSpinTimestamp) {
                const now = new Date().getTime();
                const remainingTime = MINUTES_IN-A-DAY - (now - lastSpinTimestamp);
                
                if (remainingTime <= 0) {
                    countdownElement.textContent = 'Çevirme hakkınız yenilendi!';
                    spinBtn.disabled = false;
                    prizeMessage.textContent = 'Hemen çevir ve kazan!';
                    return;
                }

                const hours = Math.floor(remainingTime / (1000 * 60 * 60));
                const minutes = Math.floor((remainingTime % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remainingTime % (1000 * 60)) / 1000);

                countdownElement.textContent = `Yeni çevirme hakkı: ${hours}sa ${minutes}dk ${seconds}sn`;
                setTimeout(() => updateCountdown(lastSpinTimestamp), 1000);
            }

            // Çark İşlevselliği
            const prizes = [
                { name: '5 Puan', value: 5 },
                { name: '10 Puan', value: 10 },
                { name: '20 Puan', value: 20 },
                { name: '50 Puan', value: 50 },
                { name: '100 Puan', value: 100 },
                { name: '200 Puan', value: 200 },
                { name: 'Ekstra Çevirme', value: null },
                { name: '30 Puan', value: 30 },
                { name: 'Kaybettin', value: 0 },
                { name: '75 Puan', value: 75 },
                { name: '150 Puan', value: 150 },
                { name: 'Şanslısın!', value: 500 } // Bonus puan
            ];
            const prizeAngles = [
                15, 45, 75, 105, 135, 165, 195, 225, 255, 285, 315, 345
            ];

            spinBtn.addEventListener('click', () => {
                if (spinBtn.disabled) return;

                prizeMessage.textContent = '';
                wheel.style.transition = 'none';
                wheel.style.transform = `rotate(0deg)`;

                setTimeout(() => {
                    const randomSegmentIndex = Math.floor(Math.random() * prizes.length);
                    const winningPrize = prizes[randomSegmentIndex];
                    const targetAngle = 360 - prizeAngles[randomSegmentIndex];
                    const spinDegrees = 360 * 7 + targetAngle;

                    wheel.style.transition = 'transform 5s cubic-bezier(0.25, 0.1, 0.25, 1)';
                    wheel.style.transform = `rotate(${spinDegrees}deg)`;
                    
                    spinBtn.disabled = true;

                    // Çevirme zamanını Firebase'e kaydet
                    const spinRef = db.ref('spins/' + user.id);
                    spinRef.set(new Date().getTime());
                    updateCountdown(new Date().getTime());

                    wheel.addEventListener('transitionend', () => {
                        prizeMessage.textContent = `Tebrikler, ${winningPrize.name} kazandınız!`;

                        // Kazanılan ödüle göre puanları veya çevirme hakkını güncelle
                        if (winningPrize.name === 'Ekstra Çevirme') {
                            spinRef.remove(); // Zaman damgasını sil
                            prizeMessage.textContent += ` Yeni bir çevirme hakkı kazandınız!`;
                            updateCountdown(new Date().getTime() - MINUTES_IN_A_DAY); // Geri sayımı sıfırla
                        } else if (winningPrize.name === 'Kaybettin') {
                             prizeMessage.textContent += ` Belki bir dahaki sefere...`;
                        } else {
                            const scoreRef = db.ref('scores/' + user.id);
                            scoreRef.transaction(currentScore => {
                                return (currentScore || 0) + winningPrize.value;
                            }).then(() => {
                                // Yeni puanı ekranda göster
                                scoreRef.once('value').then(snapshot => {
                                    const updatedScore = snapshot.val();
                                    userScoreElement.textContent = `${updatedScore} Puan`;
                                });
                            });
                        }
                    }, { once: true });
                }, 10);
            });
        });
    </script>
</body>
</html>
