<!--
  Bu dosya, bir Telegram Web Uygulaması'nı
  Firebase Firestore ile entegre ederek çok kullanıcılı ve
  gerçek zamanlı veri saklama özelliğine kavuşturur.
  Kullanıcılar bir mini oyundan puan kazanır ve bu puanlarla
  bir bonus çarkını çevirerek kodlar kazanabilir.
-->
<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Çarkıfelek Web Uygulaması</title>
    <!-- Tailwind CSS'i dahil etme -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Telegram Web App SDK'sını dahil etme -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Firebase SDK'larını uyumluluk (compat) modunda dahil etme -->
    <!-- Bu, `import` hatalarını önler ve `firebase` nesnesini global olarak erişilebilir kılar. -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    <style>
        /* Varsayılan fontu ayarlama */
        html, body {
            margin: 0;
            padding: 0;
            height: 100%; /* Tüm yüksekliği kaplamalarını sağla */
            width: 100%;
            box-sizing: border-box; /* Padding/border'ı toplam genişlik/yüksekliğe dahil et */
            overflow: hidden; /* Body'nin kaydırmasını engelle, kaydırma app-wrapper'da olacak */
        }
        body {
            font-family: 'Inter', sans-serif;
            /* Ana tema arkaplanı mor degrade */
            background: linear-gradient(135deg, #4b0082 0%, #2a0045 100%);
            color: #ffffff; /* Varsayılan yazılar beyaz */
            display: flex;
            flex-direction: column; /* İçeriği dikeyde sırala */
            align-items: center; /* Yatayda ortala */
            justify-content: flex-start; /* İçeriği dikeyde yukarıdan başlat */
        }
        .telegram-btn {
            background-color: var(--tg-theme-button-color, #a78bfa); /* Telegram tema butonu veya mor bir ton */
            color: var(--tg-theme-button-text-color, #ffffff);
            /* Daha dinamik bir düğme görünümü için gölge ve hafif kabartma */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 2px 5px rgba(0, 0, 0, 0.1), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
            border-radius: 0.75rem; /* Daha yuvarlak köşeler */
            transition: all 0.2s ease-in-out; /* Yumuşak geçişler */
        }
        .telegram-btn:hover {
            transform: translateY(-2px); /* Hafif yukarı kalkma efekti */
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3), 0 3px 8px rgba(0, 0, 0, 0.15), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
        }
        .telegram-btn:disabled {
            background-color: #555; /* Gri tonu */
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* Yükleme ekranı stili */
        #loading-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #4b0082; /* Mor arkaplan */
            color: #ffffff; /* Beyaz yazı */
            z-index: 9999;
        }
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3); /* Beyaz spinner, daha şeffaf */
            border-top: 4px solid #a78bfa; /* Mor tonunda spinner üst kenarı */
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Mesaj kutusu için stil */
        .message-box { /* Genel bir sınıf yapıldı */
            position: absolute; /* Modalların içinde absolute olarak konumlandırılacak */
            bottom: 1rem; /* Alttan boşluk */
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(51, 51, 51, 0.9); /* Mesaj kutusu için daha koyu ve yarı şeffaf bir arka plan */
            color: #ffffff; /* Beyaz yazı */
            padding: 10px 20px;
            border-radius: 8px;
            z-index: 1000;
            display: none;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); /* Daha belirgin gölge */
            width: 90%; /* Genişliği ayarla */
            max-width: 300px; /* Maksimum genişlik */
            box-sizing: border-box;
            backdrop-filter: blur(5px); /* Hafif bulanıklık efekti */
        }
        #message-box-home { /* Anasayfa mesaj kutusu için özel konumlandırma */
            position: relative; /* Anasayfa içeriğine göre konumlanır */
            margin-top: 1.5rem; /* Üstten boşluk */
            left: auto;
            transform: none;
            width: auto;
            max-width: none;
        }

        /* Çark stili (modal içinde) */
        .wheel-container {
            position: relative;
            width: min(280px, 90vw); /* Ekran genişliğine göre boyutlandır, max 280px */
            height: min(280px, 90vw); /* En boy oranını koru */
            margin: 0 auto;
            border-radius: 50%;
            overflow: hidden; /* Dilimlerin dışarı taşmasını engelle */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4); /* Daha belirgin gölge */
        }
        .wheel {
            position: relative; /* Dilimler için konteyner */
            width: 100%;
            height: 100%;
            border-radius: 50%;
            transition: transform 5s cubic-bezier(0.1, 0.9, 0.2, 1); /* Hızlı başla, yavaş dur */
            transform-origin: center center;
            overflow: hidden; /* Dilimlerin dışarı taşmasını engelle */
            background: radial-gradient(circle at center, #3a005f 0%, #1a1a1a 100%); /* Çarkın ortasından yayılan degrade */
        }
        .segment { /* Her bir çark diliminin kapsayıcısı */
            position: absolute;
            width: 50%;   /* Yarıçap kadar genişlik */
            height: 100%; /* Tam çap kadar yükseklik */
            top: 0;
            left: 50%;    /* Çarkın merkezinden başla */
            transform-origin: 0% 50%; /* Dönüş noktası çarkın merkezi */
            overflow: hidden; /* İçerideki renkli kısmı gizlemek için */
            transform: rotate(var(--rotation-angle)); /* Dilimi kendi yerine döndür */
        }
        .segment-color-fill { /* Dilimin renkli görünümünü veren kısım */
            position: absolute;
            width: 100%; /* Kapsayıcının tam genişliği */
            height: 100%; /* Kapsayıcının tam yüksekliği */
            left: 0;
            top: 0;
            background-color: var(--segment-color);
            transform-origin: 0% 50%; /* Kapsayıcının sol ortasından dön */
            transform: rotate(var(--segment-sweep-angle)); /* Dilimin yayını oluşturmak için döndür */
            border-radius: 0 100% 100% 0 / 50%; /* Yarım daire şekli */
            opacity: 0.9; /* Hafif şeffaflık */
        }
        .segment-label { /* Dilim üzerindeki okunabilir metin */
            position: absolute;
            top: 50%; /* Dikeyde ortala */
            left: 75%; /* Merkeze göre dışa doğru konumlandır */
            transform: translate(-50%, -50%) rotate(calc(-1 * var(--rotation-angle))); /* Yatayda tutmak için karşıt dönüş */
            white-space: nowrap;
            font-size: 0.8em;
            font-weight: bold;
            color: #ffffff; /* Beyaz metin */
            text-shadow: 1px 1px 3px rgba(0,0,0,0.7); /* Daha belirgin gölge */
            z-index: 2; /* Metin dilimin üstünde olsun */
            pointer-events: none; /* Metnin tıklamayı engellememesi için */
            padding: 0 5px; /* Kenarlardan boşluk */
            box-sizing: border-box;
        }
        .wheel-marker {
            position: absolute;
            width: 0;
            height: 0;
            border-left: 15px solid transparent;
            border-right: 15px solid transparent;
            border-top: 25px solid #fcd34d; /* Sarımsı renkte ok */
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10;
        }

        /* Sabit başlık stili */
        #app-header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: linear-gradient(90deg, #2a0045 0%, #4b0082 100%); /* Başlık için degrade */
            color: #ffffff;
            padding: 1rem 1.5rem; /* Yanlara ve dikeyde boşluk */
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4); /* Daha belirgin gölge */
            z-index: 10000; /* Diğer her şeyin üstünde olsun */
            display: flex;
            justify-content: space-between; /* İçeriği iki yana yasla */
            align-items: center; /* Dikeyde ortala */
            box-sizing: border-box;
            height: 60px; /* Başlık için sabit yükseklik */
        }
        #app-header .title {
            font-size: 1.6rem; /* Biraz daha büyük başlık */
            font-weight: 900;
            letter-spacing: 0.05em; /* Harf aralığı */
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }
        #app-header .user-info-display {
            text-align: right;
            font-size: 0.9rem;
        }
        #app-header .points-display {
            font-size: 1.2rem; /* Daha büyük puan yazısı */
            font-weight: bold;
            color: #fcd34d; /* Sarımsı renk puanlar için */
            text-shadow: 0 0 5px rgba(252, 211, 77, 0.5); /* Hafif parlama */
        }

        #app-wrapper {
            flex-grow: 1; /* Kalan tüm dikey boşluğu doldur */
            width: 100%;
            max-width: 600px; /* Genel içerik için maksimum genişlik */
            margin-top: 60px; /* Sabit başlığın altından başla */
            overflow-y: auto; /* Kendi içinde dikey kaydırma */
            -webkit-overflow-scrolling: touch; /* iOS'ta daha akıcı kaydırma */
            display: flex; /* İçeriğini dikeyde sıralamak için */
            flex-direction: column;
            padding-bottom: 1.5rem; /* En alt kartın altından boşluk */
        }

        #home-page-content {
            padding: 1.5rem; /* İç padding */
            background-color: rgba(26, 26, 26, 0.8); /* Uygulama kapsayıcısı için koyu şeffaf */
            border-radius: 0.75rem; /* Daha belirgin yuvarlak köşeler */
            margin: 1.5rem; /* app-wrapper içinde üstten alttan boşluk */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5); /* Daha büyük ve derin gölge */
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* Bölümler arası boşluk */
            align-items: center; /* İçerikleri yatayda ortala */
            flex-grow: 1; /* Home page içeriğinin de kendi içinde büyümesini sağlar */
            backdrop-filter: blur(8px); /* Hafif bulanıklık efekti */
            border: 1px solid rgba(255, 255, 255, 0.1); /* İnce beyaz kenarlık */
        }
        
        /* Başlıklar için renk güncellemesi */
        h1, h2 {
            color: #fcd34d; /* Başlıklar sarımsı olsun */
            font-weight: 900; /* Daha kalın ve etkileyici */
            text-shadow: 0 0 8px rgba(252, 211, 77, 0.6); /* Hafif parlama */
        }

        /* Tüm küçük yazıları beyaz yapalım */
        .text-gray-600 {
            color: #e0e0e0; /* Daha açık gri tonu, daha okunabilir */
        }

        /* Kullanıcı adı giriş modal stili */
        #username-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Daha koyu arka plan */
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            backdrop-filter: blur(8px); /* Bulanıklık efekti */
        }
        .username-modal-content {
            background: linear-gradient(180deg, #1a1a1a 0%, #333333 100%); /* Degradeli arka plan */
            padding: 2.5rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak köşeler */
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5); /* Daha büyük gölge */
            max-width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .username-modal-content input {
            width: 100%;
            padding: 0.75rem;
            margin-top: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0.5rem;
            border: 1px solid #555; /* Daha belirgin kenarlık */
            background-color: #2a2a2a;
            color: #ffffff;
            font-size: 1em;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.3); /* İç gölge */
        }
        .username-modal-content button {
            width: 100%;
            padding: 0.9rem; /* Daha büyük padding */
            border-radius: 0.75rem; /* Daha yuvarlak köşeler */
            background-color: #a78bfa;
            color: #ffffff;
            font-weight: bold;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), inset 0 -2px 0 rgba(0, 0, 0, 0.1);
        }
        .username-modal-content button:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3), inset 0 -2px 0 rgba(0, 0, 0, 0.1);
        }

        /* Genel Modal Stili (Çark, Hızlı Tıkla, Sayı Tahmin, Taş Kağıt Makas) */
        .game-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* Daha koyu yarı saydam arka plan */
            display: none; /* Varsayılan olarak gizli */
            align-items: center;
            justify-content: center;
            z-index: 10001;
            opacity: 0;
            transition: opacity 0.3s ease; /* Sadece opacity geçişi */
            backdrop-filter: blur(8px); /* Bulanıklık efekti */
        }
        .game-modal.open {
            opacity: 1;
            /* display: flex; JavaScript tarafından yönetilecek */
        }
        .game-modal-content {
            background: linear-gradient(180deg, #1a1a1a 0%, #333333 100%); /* Degradeli arka plan */
            padding: 2.5rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak köşeler */
            text-align: center;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5); /* Daha büyük gölge */
            max-width: 90%;
            width: 400px; /* Modal için sabit genişlik */
            position: relative; /* Mesaj kutusu için göreceli konum */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-modal-close-btn { /* Modal kapatma butonu için genel sınıf */
            position: absolute;
            top: 15px; /* Konumu ayarla */
            right: 15px; /* Konumu ayarla */
            background: none;
            border: none;
            color: #fcd34d; /* Sarımsı renk */
            font-size: 2.2em; /* Daha büyük */
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        .game-modal-close-btn:hover {
            transform: rotate(90deg); /* Kapatırken dönme efekti */
        }

        /* Oyun kartı stili (Ana sayfadaki görsel) */
        .game-card-homepage { /* Ana sayfadaki tıklanabilir oyun kartları */
            background: linear-gradient(145deg, #2a0045 0%, #4b0082 100%); /* Degradeli arka plan */
            padding: 1.5rem;
            border-radius: 1rem; /* Daha yuvarlak köşeler */
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease-in-out; /* Yumuşak geçişler */
            max-width: 300px; /* Orta boyutlu kart */
            width: 100%; /* Mobil uyumluluk */
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3), inset 0 2px 5px rgba(255, 255, 255, 0.1); /* Daha belirgin ve iç gölge */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .game-card-homepage:hover {
            transform: translateY(-8px) scale(1.02); /* Daha belirgin büyüme ve kalkma */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.5), inset 0 2px 8px rgba(255, 255, 255, 0.2);
        }
        .game-card-homepage img {
            width: 100px; /* Resim boyutu */
            height: 100px;
            margin: 0 auto 1rem auto;
            border-radius: 50%; /* Yuvarlak resim */
            object-fit: cover;
            border: 3px solid #fcd34d; /* Sarımsı çerçeve */
            box-shadow: 0 0 15px rgba(252, 211, 77, 0.5); /* Resme parlama efekti */
            transition: all 0.3s ease-in-out;
        }
        .game-card-homepage:hover img {
            transform: scale(1.05); /* Hover'da resmin de büyümesi */
            box-shadow: 0 0 20px rgba(252, 211, 77, 0.8);
        }
        
        /* Mini Oyunlar bölümü stili */
        #mini-games-section {
            width: 100%;
            background: linear-gradient(160deg, #2a0045 0%, #3a005f 100%); /* Degradeli arka plan */
            padding: 2rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak köşeler */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            display: flex; /* İçindeki oyunları da flex ile sırala */
            flex-direction: column;
            gap: 1.5rem; /* Oyunlar arası boşluk */
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Bonus Kodları bölümü stili */
        #bonus-codes-list-section {
            width: 100%;
            background: linear-gradient(160deg, #2a0045 0%, #3a005f 100%); /* Degradeli arka plan */
            padding: 2rem; /* Daha fazla padding */
            border-radius: 1rem; /* Daha yuvarlak köşeler */
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        #bonus-codes-list li {
            background-color: rgba(75, 0, 130, 0.3); /* Listeler için şeffaf mor arkaplan */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.2);
        }
        #bonus-codes-list li::before {
            content: '💎'; /* Elmas emojisi */
            font-size: 1.2em;
        }

        /* Taş-Kağıt-Makas butonları için düzen */
        #rps-choices {
            display: flex;
            justify-content: center;
            gap: 0.75rem; /* Butonlar arasında boşluk */
            margin-bottom: 1rem;
        }
        #rps-choices .rps-btn {
            padding: 0.75rem 1.25rem;
            font-size: 1.1em;
            font-weight: bold;
            flex: 1; /* Eşit genişlik */
            max-width: 120px; /* Maksimum genişlik */
            /* telegram-btn'in stilini kullanır */
        }
        #rps-result-display-text {
            font-weight: bold;
            margin-bottom: 1rem;
            font-size: 1.3em; /* Daha büyük metin */
            text-shadow: 0 0 5px rgba(255,255,255,0.7);
        }
        #rps-play-again-button {
            background-color: #555; /* Gri tonu */
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2), inset 0 -3px 0 rgba(0, 0, 0, 0.2);
        }
        #rps-play-again-button:hover {
            background-color: #666;
            transform: translateY(-1px);
        }
        #rps-player-choice-display, #rps-computer-choice-display {
            font-weight: bold;
            color: #fcd34d; /* Sarımsı renk */
            text-shadow: 0 0 5px rgba(252, 211, 77, 0.5);
        }
    </style>
</head>
<body>
    <!-- Yükleme Ekranı -->
    <div id="loading-screen" class="space-y-4">
        <div class="spinner"></div>
        <p class="text-sm">Bağlanıyor...</p>
    </div>

    <!-- Kullanıcı Adı Belirleme Modalı -->
    <div id="username-modal" class="hidden">
        <div class="username-modal-content">
            <h2 class="text-xl font-bold mb-4">Hoş Geldin!</h2>
            <p class="text-sm text-gray-600">Devam etmek için bir kullanıcı adı belirle.</p>
            <input type="text" id="username-input" placeholder="Kullanıcı adını gir..." maxlength="20">
            <button id="save-username-btn" class="telegram-btn">Kullanıcı Adını Kaydet</button>
        </div>
    </div>

    <!-- Sabit Uygulama Başlığı -->
    <header id="app-header">
        <div class="flex items-center">
            <span class="title">Çarkıfelek Uygulaması</span>
        </div>
        <div class="user-info-display">
            <p id="user-info-header" class="text-sm font-semibold">Yükleniyor...</p>
            <p id="points-display-header" class="points-display">Puan: 0</p>
        </div>
    </header>

    <!-- Ana Uygulama İçeriği (Kaydırılabilir Alan) -->
    <div id="app-wrapper">
        <div id="home-page-content" class="text-center hidden">
            <h1 class="text-3xl font-bold mb-4">Hoş Geldin!</h1>
            <p class="text-sm text-gray-600 mb-6">Puan kazanmak ve bonus kodları almak için oyna!</p>

            <!-- Mini Oyunlar Bölümü -->
            <section id="mini-games-section" class="w-full">
                <h2 class="text-xl font-bold mb-4">Mini Oyunlar</h2>
                <p class="text-sm text-gray-600 mb-4">Puan toplamak için farklı oyun seçenekleri.</p>
                
                <!-- Mini Oyun Kartı: Hızlı Tıkla! -->
                <div id="fast-click-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/6f2da8/FFFFFF?text=TIKLA" alt="Hızlı Tıkla!" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">Hızlı Tıkla!</h3>
                    <p class="text-sm text-gray-600">Butona basarak puan kazan.</p>
                </div>

                <!-- Mini Oyun Kartı: Sayı Tahmin Oyunu -->
                <div id="guess-game-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/8a2be2/FFFFFF?text=SAYI" alt="Sayı Tahmin Oyunu" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">Sayı Tahmin Oyunu</h3>
                    <p class="text-sm text-gray-600">Sayıyı tahmin et, puanı kap!</p>
                </div>

                <!-- Mini Oyun Kartı: Taş, Kağıt, Makas -->
                <div id="rps-game-card" class="game-card-homepage">
                    <img src="https://placehold.co/100x100/b19cd9/FFFFFF?text=RPS" alt="Taş, Kağıt, Makas" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                    <h3 class="text-xl font-bold mb-2">Taş, Kağıt, Makas!</h3>
                    <p class="text-sm text-gray-600">Bilgisayarı yen ve puan kazan.</p>
                </div>
            </section>
            
            <!-- Çarkıfelek Kartı -->
            <div id="wheel-card" class="game-card-homepage">
                <img src="https://placehold.co/100x100/A78BFA/FFFFFF?text=ÇARK" alt="Çarkıfelek" class="mx-auto mb-4 rounded-full object-cover border-2 border-purple-400">
                <h3 class="text-xl font-bold mb-2">Bonus Çarkı</h3>
                <p class="text-sm text-gray-600">Çevirmek için tıkla ve bonus kazan!</p>
            </div>

            <!-- Bonus Kodları Bölümü -->
            <section id="bonus-codes-list-section" class="w-full">
                <h2 class="text-xl font-bold mb-4">Kazanılan Bonus Kodları</h2>
                <ul id="bonus-codes-list" class="text-sm text-gray-600 space-y-2">
                    <!-- Bonus kodları buraya eklenecek -->
                </ul>
            </section>

            <!-- Mesaj kutusu öğesi -->
            <div id="message-box-home" class="message-box"></div>
        </div>
    </div>

    <!-- Tüm Oyun Modalları -->

    <!-- Çarkıfelek Modalı -->
    <div id="wheel-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="wheel-modal-close-btn" class="game-modal-close-btn">×</button>
            <h2 class="text-xl font-bold mb-4">Bonus Çarkı</h2>
            <p class="text-sm text-gray-600 mb-4">Çarkı çevirmek için 100 puana ihtiyacın var.</p>
            <div class="wheel-container">
                <div class="wheel-marker"></div>
                <div id="wheel-element" class="wheel">
                    <!-- Çark dilimleri ve metin etiketleri dinamik olarak eklenecek -->
                </div>
            </div>
            <button id="wheel-spin-button" class="telegram-btn w-full py-3 mt-6 transition duration-200 hover:opacity-80 disabled:opacity-50" disabled>
                <span id="spin-button-text">Çarkı Çevir (100 Puan)</span>
            </button>
            <!-- Mesaj kutusu öğesi (modal içinde) -->
            <div id="message-box-wheel-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- Hızlı Tıkla! Modalı -->
    <div id="fast-click-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="fast-click-modal-close-btn" class="game-modal-close-btn">×</button>
            <h2 class="text-xl font-bold mb-4">Hızlı Tıkla!</h2>
            <p class="text-sm text-gray-600 mb-3">Butona her tıkladığınızda 10 puan kazanırsınız.</p>
            <button id="fast-click-game-button" class="telegram-btn w-full py-3 transition duration-200 hover:opacity-80">
                <span id="fast-click-game-button-text">Puan Kazan (+10)</span>
            </button>
            <div id="message-box-fast-click-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- Sayı Tahmin Oyunu Modalı -->
    <div id="guess-game-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="guess-game-modal-close-btn" class="game-modal-close-btn">×</button>
            <h2 class="text-xl font-bold mb-4">Sayı Tahmin Oyunu</h2>
            <p class="text-sm text-gray-600 mb-3">1 ile 100 arasında bir sayı tuttum. 7 tahmin hakkın var!</p>
            <input type="number" id="guess-game-input" class="w-full p-2 mb-3 rounded-md bg-gray-700 text-white border-none text-center" placeholder="Tahminini gir (1-100)">
            <button id="guess-game-submit-button" class="telegram-btn w-full py-2 mb-2 transition duration-200 hover:opacity-80">Tahmin Et</button>
            <p id="guess-game-feedback" class="text-sm text-gray-400 mb-3"></p>
            <button id="guess-game-new-button" class="telegram-btn bg-gray-500 hover:bg-gray-600 w-full py-2 transition duration-200 hover:opacity-80 hidden">Yeni Oyun Başlat</button>
            <div id="message-box-guess-game-modal" class="message-box mt-4"></div>
        </div>
    </div>

    <!-- Taş, Kağıt, Makas Modalı -->
    <div id="rps-game-modal" class="game-modal">
        <div class="game-modal-content">
            <button id="rps-game-modal-close-btn" class="game-modal-close-btn">×</button>
            <h2 class="text-xl font-bold mb-4">Taş, Kağıt, Makas!</h2>
            <p class="text-sm text-gray-600 mb-3">Bilgisayarı yen, 20 puan kazan!</p>
            <div id="rps-choices" class="flex justify-center gap-3 mb-4">
                <button id="rps-rock-btn" class="rps-btn telegram-btn">Taş</button>
                <button id="rps-paper-btn" class="rps-btn telegram-btn">Kağıt</button>
                <button id="rps-scissors-btn" class="rps-btn telegram-btn">Makas</button>
            </div>
            <div class="mb-3">
                Senin seçimin: <span id="rps-player-choice-display" class="text-yellow-300"></span><br>
                Bilgisayarın seçimi: <span id="rps-computer-choice-display" class="text-yellow-300"></span>
            </div>
            <p id="rps-result-display-text" class="text-base text-white font-bold mb-3"></p>
            <button id="rps-play-again-button" class="telegram-btn bg-gray-500 hover:bg-gray-600 w-full py-2 transition duration-200 hover:opacity-80 hidden">Tekrar Oyna</button>
            <div id="message-box-rps-game-modal" class="message-box mt-4"></div>
        </div>
    </div>


    <script>
        // Firebase ve Uygulama Ayarlarını Global Değişkenlerden Alın
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        // Kendi firebaseConfig'inizi buraya yapıştırın.
        const firebaseConfig = {
            apiKey: "AIzaSyBnktrT7Pp7WucJP_xtEu_mmQle_VthRAE",
            authDomain: "onwingiris-afccf.firebaseapp.com",
            projectId: "onwingiris-afccf",
            storageBucket: "onwingiris-afccf.firebasestorage.app",
            messagingSenderId: "1059998132611",
            appId: "1:1059998132611:web:7f415159c54936cc796eb6",
            measurementId: "G-RE79PDJSJX"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth, userId, userDocRef;
        let isSpinning = false;
        
        // Bonus çarkı için bölümler - Mor ve siyah tonlarında güncellendi
        const segments = [
            { text: "10 TL Bonus", color: "#6f2da8", type: "bonus_code" }, // Açık mor
            { text: "Tekrar Dene", color: "#1a1a1a", type: "try_again" }, // Siyah
            { text: "25 TL Bonus", color: "#8a2be2", type: "bonus_code" }, // Orta mor
            { text: "Tekrar Dene", color: "#2a0045", type: "try_again" }, // Koyu mor
            { text: "50 TL Bonus", color: "#b19cd9", type: "bonus_code" }, // Lavanta moru
            { text: "Tekrar Dene", color: "#3a005f", type: "try_again" }, // Çok koyu mor
            { text: "25 TL Bonus", color: "#c3aed6", type: "bonus_code" }, // Daha açık lavanta
            { text: "Tekrar Dene", color: "#1a1a1a", type: "try_again" }  // Siyah
        ];

        // HTML elemanları (DOMContentLoaded içinde tanımlanacak)
        let loadingScreen, usernameModal, usernameInput, saveUsernameBtn;
        let appHeader, userInfoHeader, pointsDisplayHeader;
        let appWrapper, homePageContent, bonusCodesListSection, bonusCodesList;
        // Anasayfa oyun kartları
        let wheelCard, fastClickCard, guessGameCard, rpsGameCard;

        // Modallar ve içindeki elemanlar
        let wheelModal, wheelModalCloseBtn, wheelElement, wheelSpinButton, messageBoxWheelModal; // wheelSpinButton olarak güncellendi
        let fastClickModal, fastClickModalCloseBtn, fastClickGameButton, messageBoxFastClickModal; // fastClickGameButton olarak güncellendi
        let guessGameModal, guessGameModalCloseBtn, guessGameInput, guessGameSubmitButton, guessGameFeedback, guessGameNewButton, messageBoxGuessGameModal; // unique ID'ler
        let rpsGameModal, rpsGameModalCloseBtn, rpsRockBtn, rpsPaperBtn, rpsScissorsBtn, rpsPlayerChoiceDisplay, rpsComputerChoiceDisplay, rpsResultDisplayText, rpsPlayAgainButton, messageBoxRpsGameModal; // unique ID'ler

        let messageBoxHome; // Anasayfa için genel mesaj kutusu

        // Sayı Tahmin Oyunu Değişkenleri
        let targetNumber, attemptsLeft, gameOver;
        const MAX_ATTEMPTS = 7;
        const MIN_NUM = 1;
        const MAX_NUM = 100;
        const GUESS_GAME_WIN_POINTS = 50;

        // Taş-Kağıt-Makas Oyunu Değişkenleri
        const choices = ['taş', 'kağıt', 'makas'];
        const RPS_GAME_WIN_POINTS = 20;

        // MODAL YÖNETİMİ BAŞLANGIÇ
        function openModal(modalElement) {
            modalElement.style.display = 'flex'; // Önce display'i ayarla
            setTimeout(() => { // Geçişin tetiklenmesi için kısa bir gecikme
                modalElement.classList.add('open');
            }, 10);
        }

        function closeModal(modalElement) {
            modalElement.classList.remove('open');
            modalElement.addEventListener('transitionend', function handler() {
                modalElement.style.display = 'none'; // Geçiş bittikten sonra display'i gizle
                modalElement.removeEventListener('transitionend', handler); // Dinleyiciyi kaldır
            }, { once: true });
        }
        // MODAL YÖNETİMİ BİTİŞ

        // Kullanıcıya mesaj göstermek için özel fonksiyon (hedef kutu ID'sine göre)
        function showMessage(text, isError = false, targetBoxId = 'message-box-home') {
            let targetBox = document.getElementById(targetBoxId);
            if (!targetBox) {
                console.error(`Hata: ${targetBoxId} HTML elementi henüz bulunamadı. Mesaj:`, text);
                return;
            }
            targetBox.textContent = text;
            if (isError) {
                targetBox.style.backgroundColor = '#dc3545'; // Kırmızı arka plan
            } else {
                targetBox.style.backgroundColor = '#333'; // Varsayılan arka plan
            }
            targetBox.style.display = 'block';
            setTimeout(() => {
                targetBox.style.display = 'none';
            }, 3000); // 3 saniye sonra gizle
        }

        // Çarkı dinamik olarak oluşturma
        function createWheel() {
            const numSegments = segments.length;
            const segmentAngle = 360 / numSegments;
            
            if (wheelElement) wheelElement.innerHTML = ''; // Çarkı temizle
            
            segments.forEach((segmentData, index) => {
                const rotationAngle = index * segmentAngle; // Segmentin dönme açısı

                // Her bir dilim için kapsayıcı div
                const segmentEl = document.createElement('div');
                segmentEl.className = 'segment';
                segmentEl.style.setProperty('--rotation-angle', `${rotationAngle}deg`);
                segmentEl.style.setProperty('--segment-color', segmentData.color);
                segmentEl.style.setProperty('--segment-sweep-angle', `${segmentAngle}deg`); // Dilim yay açısı

                // Renkli kısmın kendisi
                const colorFillEl = document.createElement('div');
                colorFillEl.className = 'segment-color-fill';
                segmentEl.appendChild(colorFillEl);

                // Segmentin içindeki metin etiketi
                const labelEl = document.createElement('div');
                labelEl.className = 'segment-label';
                labelEl.textContent = segmentData.text;
                // Metni yatay tutmak için karşıt dönüş
                labelEl.style.setProperty('--rotation-angle', `${rotationAngle}deg`); 

                segmentEl.appendChild(labelEl);
                if (wheelElement) wheelElement.appendChild(segmentEl);
            });
        }

        // Firebase'i başlat ve kullanıcıyı yetkilendir
        async function initializeFirebase() {
            try {
                // Firebase'i başlatma
                const app = firebase.initializeApp(firebaseConfig);
                auth = firebase.auth(); // compat versiyonunda bu şekilde
                db = firebase.firestore(); // compat versiyonunda bu şekilde

                // Kullanıcı yetkilendirmesi
                if (initialAuthToken) {
                    await auth.signInWithCustomToken(initialAuthToken);
                } else {
                    await auth.signInAnonymously();
                }

                auth.onAuthStateChanged(async (user) => {
                    if (user) {
                        userId = user.uid;
                        // Firestore collection ve doc referanslarını düzeltme
                        userDocRef = db.collection(`artifacts/${appId}/public/data/game_data`).doc(userId);
                        
                        // Kullanıcı verilerini Firestore'dan al veya oluştur
                        const docSnap = await userDocRef.get();
                        
                        if (!docSnap.exists) {
                            // Yeni kullanıcı, varsayılan verileri ayarla
                            await userDocRef.set({
                                username: null, // Kullanıcı adı boş olarak başla
                                points: 0,
                                bonusCodes: [],
                                lastClick: 0
                            });
                            // Kullanıcı adı modalını göster
                            loadingScreen.style.display = 'none';
                            if (usernameModal) openModal(usernameModal);
                        } else {
                            const userData = docSnap.data();
                            if (!userData.username) {
                                // Kullanıcı var ama kullanıcı adı ayarlı değil
                                loadingScreen.style.display = 'none';
                                if (usernameModal) openModal(usernameModal);
                            } else {
                                // Kullanıcı adı zaten ayarlı, ana uygulamayı göster
                                loadingScreen.style.display = 'none';
                                if (homePageContent) homePageContent.style.display = 'flex';
                                listenForDataChanges();
                            }
                        }
                    } else {
                        // Eğer kimlik doğrulama başarısız olursa, bir hata mesajı göster
                        console.error("Kimlik doğrulama başarısız oldu, kullanıcı nesnesi boş.");
                        loadingScreen.style.display = 'none';
                        showMessage('Kimlik doğrulama başarısız oldu, lütfen uygulamayı tekrar açın.', true, 'message-box-home');
                    }
                });
            } catch (error) {
                // Firebase başlatılırken veya kimlik doğrulanırken oluşan hataları yakala
                console.error("Firebase başlatılırken bir hata oluştu:", error);
                loadingScreen.style.display = 'none';
                showMessage(`Uygulama başlatılırken bir hata oluştu: ${error.message}`, true, 'message-box-home');
            }
        }
        
        // Firestore'dan gerçek zamanlı veri dinleme
        function listenForDataChanges() {
            userDocRef.onSnapshot((doc) => {
                if (doc.exists) {
                    const data = doc.data();
                    updateUI(data);
                }
            });
        }
        
        // UI'ı verilerle güncelleme
        function updateUI(data) {
            // Header'daki puan ve kullanıcı adını güncelle
            if (pointsDisplayHeader) pointsDisplayHeader.textContent = `Puan: ${data.points}`;
            
            if (userInfoHeader) {
                if (data.username) {
                    userInfoHeader.textContent = `Kullanıcı: ${data.username}`;
                } else {
                    userInfoHeader.textContent = `Kullanıcı Kimliği: ${userId}`;
                }
            }
            
            // Bonus kodlarını listele
            if (bonusCodesList) {
                bonusCodesList.innerHTML = '';
                if (data.bonusCodes && data.bonusCodes.length > 0) {
                    data.bonusCodes.forEach(code => {
                        const li = document.createElement('li');
                        li.textContent = `• ${code}`;
                        bonusCodesList.appendChild(li);
                    });
                } else {
                    const li = document.createElement('li');
                    li.textContent = "Henüz kazanılmış bonus kodunuz yok.";
                    bonusCodesList.appendChild(li);
                }
            }

            // Çarkı çevir butonunu etkinleştirme
            if (wheelSpinButton) wheelSpinButton.disabled = data.points < 100 || isSpinning;
        }

        // Kullanıcı adını kaydetme fonksiyonu
        async function saveUsername() {
            console.log("saveUsername çağrıldı.");
            const username = usernameInput.value.trim();
            if (username.length < 3 || username.length > 20) {
                showMessage("Kullanıcı adı 3 ile 20 karakter arasında olmalıdır.", true, 'message-box-home');
                console.log("Kullanıcı adı doğrulama başarısız.");
                return;
            }
            console.log("Kullanıcı adı doğrulama başarılı:", username);

            try {
                // Kullanıcı adının benzersizliğini kontrol et (ve mevcut kullanıcının kendi adı olup olmadığını)
                const usernameQuery = await db.collection(`artifacts/${appId}/public/data/game_data`).where('username', '==', username).get();
                
                if (!usernameQuery.empty) {
                    // Bu kullanıcı adını kullanan bir belge bulundu
                    const existingUserDoc = usernameQuery.docs[0];
                    if (existingUserDoc.id !== userId) {
                        // Eğer bu kullanıcı adı başka bir kullanıcıya aitse
                        showMessage("Bu kullanıcı adı zaten alınmış, lütfen başka bir tane dene.", true, 'message-box-home');
                        console.log("Kullanıcı adı başka bir kullanıcı tarafından alınmış.");
                        return;
                    }
                    // Eğer bu kullanıcı adı mevcut kullanıcının kendisiyse, devam et.
                    console.log("Kullanıcı adı mevcut kullanıcının kendi adı.");
                }
                console.log("Kullanıcı adı benzersizlik kontrolü başarılı veya mevcut kullanıcıya ait.");

                await userDocRef.update({ username: username });
                console.log("Firestore'a kullanıcı adı başarıyla güncellendi.");

                // UI elementlerinin varlığını kontrol et
                if (usernameModal && homePageContent) {
                    closeModal(usernameModal);
                    homePageContent.style.display = 'flex'; // 'block' yerine 'flex'
                    console.log("UI güncellendi: usernameModal gizlendi, homePageContent gösterildi.");
                } else {
                    console.error("Hata: usernameModal veya homePageContent bulunamadı. UI güncellenemedi.");
                    showMessage("Uygulama arayüzü güncellenemedi, lütfen tekrar deneyin.", true, 'message-box-home');
                }

                showMessage(`Hoş geldin, ${username}!`, false, 'message-box-home');
                listenForDataChanges(); // Kullanıcı adı kaydedildikten sonra UI'ı güncelle
            } catch (e) {
                console.error("Kullanıcı adı kaydedilirken hata oluştu: ", e);
                showMessage("Kullanıcı adı kaydedilirken bir hata oluştu, lütfen tekrar deneyin. Detay: " + e.message, true, 'message-box-home');
            }
        }

        // Sayı Tahmin Oyunu Mantığı
        function startGame() {
            targetNumber = Math.floor(Math.random() * (MAX_NUM - MIN_NUM + 1)) + MIN_NUM;
            attemptsLeft = MAX_ATTEMPTS;
            gameOver = false;
            if (guessGameInput) guessGameInput.value = '';
            if (guessGameInput) guessGameInput.disabled = false;
            if (guessGameSubmitButton) guessGameSubmitButton.disabled = false;
            if (guessGameNewButton) guessGameNewButton.classList.add('hidden');
            updateGuessFeedback(`Kalan tahmin hakkı: ${attemptsLeft}`, false); // Modala özel mesaj kutusu yok, genel kullanacak
        }

        function updateGuessFeedback(message, isError = false) {
            if (guessGameFeedback) {
                guessGameFeedback.textContent = message;
                guessGameFeedback.style.color = isError ? '#dc3545' : '#ffffff';
            }
        }

        async function checkGuess() {
            if (gameOver) return;

            const guess = parseInt(guessGameInput.value);

            if (isNaN(guess) || guess < MIN_NUM || guess > MAX_NUM) {
                updateGuessFeedback(`Lütfen ${MIN_NUM} ile ${MAX_NUM} arasında geçerli bir sayı girin.`, true);
                return;
            }

            attemptsLeft--;

            if (guess === targetNumber) {
                updateGuessFeedback(`Tebrikler! Sayıyı ${MAX_ATTEMPTS - attemptsLeft} tahminde buldun! (+${GUESS_GAME_WIN_POINTS} Puan)`, false);
                gameOver = true;
                if (guessGameInput) guessGameInput.disabled = true;
                if (guessGameSubmitButton) guessGameSubmitButton.disabled = true;
                if (guessGameNewButton) guessGameNewButton.classList.remove('hidden');
                
                // Puanı Firestore'a kaydet
                try {
                    const docSnap = await userDocRef.get();
                    await userDocRef.update({
                        points: (docSnap.data().points || 0) + GUESS_GAME_WIN_POINTS
                    });
                    showMessage(`${GUESS_GAME_WIN_POINTS} puan kazandın!`, false, 'message-box-guess-game-modal');
                } catch (e) {
                    console.error("Puan güncellenirken hata oluştu: ", e);
                    showMessage("Puan kaydedilirken bir hata oluştu.", true, 'message-box-guess-game-modal');
                }

            } else if (attemptsLeft === 0) {
                updateGuessFeedback(`Üzgünüm, tahmin hakkın kalmadı! Sayı ${targetNumber} idi.`, true);
                gameOver = true;
                if (guessGameInput) guessGameInput.disabled = true;
                if (guessGameSubmitButton) guessGameSubmitButton.disabled = true;
                if (guessGameNewButton) guessGameNewButton.classList.remove('hidden');
            } else {
                const hint = guess < targetNumber ? 'daha yüksek' : 'daha düşük';
                updateGuessFeedback(`Yanlış! Sayı ${hint}. Kalan tahmin hakkı: ${attemptsLeft}`);
            }
            if (guessGameInput) guessGameInput.value = ''; // Tahmin kutusunu temizle
        }

        // Taş-Kağıt-Makas Oyunu Mantığı
        function initializeRPSGame() {
            if (rpsPlayerChoiceDisplay) rpsPlayerChoiceDisplay.textContent = '';
            if (rpsComputerChoiceDisplay) rpsComputerChoiceDisplay.textContent = '';
            if (rpsResultDisplayText) rpsResultDisplayText.textContent = 'Bir seçim yap!';
            if (rpsRockBtn) rpsRockBtn.disabled = false;
            if (rpsPaperBtn) rpsPaperBtn.disabled = false;
            if (rpsScissorsBtn) rpsScissorsBtn.disabled = false;
            if (rpsPlayAgainButton) rpsPlayAgainButton.classList.add('hidden');
            if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#ffffff'; // Varsayılan renk
        }

        async function playRPSGame(playerChoice) {
            if (!userId) {
                showMessage("Kullanıcı verisi yükleniyor, lütfen bekleyin.", true, 'message-box-rps-game-modal');
                return;
            }

            // Seçim butonlarını devre dışı bırak
            if (rpsRockBtn) rpsRockBtn.disabled = true;
            if (rpsPaperBtn) rpsPaperBtn.disabled = true;
            if (rpsScissorsBtn) rpsScissorsBtn.disabled = true;

            const computerChoice = choices[Math.floor(Math.random() * choices.length)];

            if (rpsPlayerChoiceDisplay) rpsPlayerChoiceDisplay.textContent = playerChoice.charAt(0).toUpperCase() + playerChoice.slice(1);
            if (rpsComputerChoiceDisplay) rpsComputerChoiceDisplay.textContent = computerChoice.charAt(0).toUpperCase() + computerChoice.slice(1);

            let result;
            let isWin = false;

            if (playerChoice === computerChoice) {
                result = 'Berabere!';
            } else if (
                (playerChoice === 'taş' && computerChoice === 'makas') ||
                (playerChoice === 'kağıt' && computerChoice === 'taş') ||
                (playerChoice === 'makas' && computerChoice === 'kağıt')
            ) {
                result = 'Kazandın! (+20 Puan)';
                isWin = true;
            } else {
                result = 'Kaybettin.';
            }

            if (rpsResultDisplayText) rpsResultDisplayText.textContent = result;
            if (isWin) {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#a78bfa'; // Mor renk
                try {
                    const docSnap = await userDocRef.get();
                    await userDocRef.update({
                        points: (docSnap.data().points || 0) + RPS_GAME_WIN_POINTS
                    });
                    showMessage(`${RPS_GAME_WIN_POINTS} puan kazandın!`, false, 'message-box-rps-game-modal');
                } catch (e) {
                    console.error("RPS puanı güncellenirken hata oluştu: ", e);
                    showMessage("Puan kaydedilirken bir hata oluştu.", true, 'message-box-rps-game-modal');
                }
            } else if (result === 'Berabere!') {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#fcd34d'; // Sarımsı
            } else {
                if (rpsResultDisplayText) rpsResultDisplayText.style.color = '#dc3545'; // Kırmızı
            }
            
            if (rpsPlayAgainButton) rpsPlayAgainButton.classList.remove('hidden');
        }


        // Uygulama yüklendiğinde başlat
        document.addEventListener('DOMContentLoaded', () => { 
            // HTML elemanlarını DOM yüklendikten sonra al ve global değişkenlere ata
            loadingScreen = document.getElementById('loading-screen');
            usernameModal = document.getElementById('username-modal');
            usernameInput = document.getElementById('username-input');
            saveUsernameBtn = document.getElementById('save-username-btn');

            appHeader = document.getElementById('app-header');
            userInfoHeader = document.getElementById('user-info-header');
            pointsDisplayHeader = document.getElementById('points-display-header');

            appWrapper = document.getElementById('app-wrapper');
            homePageContent = document.getElementById('home-page-content');
            bonusCodesListSection = document.getElementById('bonus-codes-list-section');
            bonusCodesList = document.getElementById('bonus-codes-list');
            messageBoxHome = document.getElementById('message-box-home');

            // Anasayfa oyun kartları
            wheelCard = document.getElementById('wheel-card');
            fastClickCard = document.getElementById('fast-click-card');
            guessGameCard = document.getElementById('guess-game-card');
            rpsGameCard = document.getElementById('rps-game-card');

            // Modallar ve içindeki elemanlar
            wheelModal = document.getElementById('wheel-modal');
            wheelModalCloseBtn = document.getElementById('wheel-modal-close-btn');
            wheelElement = document.getElementById('wheel-element'); // Çarkın kendisi ID'si güncellendi
            wheelSpinButton = document.getElementById('wheel-spin-button'); // ID güncellendi
            messageBoxWheelModal = document.getElementById('message-box-wheel-modal');

            fastClickModal = document.getElementById('fast-click-modal');
            fastClickModalCloseBtn = document.getElementById('fast-click-modal-close-btn');
            fastClickGameButton = document.getElementById('fast-click-game-button'); // ID güncellendi
            messageBoxFastClickModal = document.getElementById('message-box-fast-click-modal');

            guessGameModal = document.getElementById('guess-game-modal');
            guessGameModalCloseBtn = document.getElementById('guess-game-modal-close-btn');
            guessGameInput = document.getElementById('guess-game-input'); // ID güncellendi
            guessGameSubmitButton = document.getElementById('guess-game-submit-button'); // ID güncellendi
            guessGameFeedback = document.getElementById('guess-game-feedback'); // ID güncellendi
            guessGameNewButton = document.getElementById('guess-game-new-button'); // ID güncellendi
            messageBoxGuessGameModal = document.getElementById('message-box-guess-game-modal');

            rpsGameModal = document.getElementById('rps-game-modal');
            rpsGameModalCloseBtn = document.getElementById('rps-game-modal-close-btn');
            rpsRockBtn = document.getElementById('rps-rock-btn'); // ID güncellendi
            rpsPaperBtn = document.getElementById('rps-paper-btn'); // ID güncellendi
            rpsScissorsBtn = document.getElementById('rps-scissors-btn'); // ID güncellendi
            rpsPlayerChoiceDisplay = document.getElementById('rps-player-choice-display'); // ID güncellendi
            rpsComputerChoiceDisplay = document.getElementById('rps-computer-choice-display'); // ID güncellendi
            rpsResultDisplayText = document.getElementById('rps-result-display-text'); // ID güncellendi
            rpsPlayAgainButton = document.getElementById('rps-play-again-button'); // ID güncellendi
            messageBoxRpsGameModal = document.getElementById('message-box-rps-game-modal');


            // Kullanıcı adı kaydetme butonu için olay dinleyici
            if (saveUsernameBtn) {
                saveUsernameBtn.addEventListener('click', saveUsername);
            } else {
                console.error("Hata: saveUsernameBtn HTML elementi bulunamadı!");
                showMessage("Uygulama yüklenirken bir sorun oluştu (Kullanıcı Adı Kaydet Butonu bulunamadı).", true, 'message-box-home');
            }

            // Hızlı Tıkla! kartına tıklama olayı (modalı açar)
            if (fastClickCard) {
                fastClickCard.addEventListener('click', () => {
                    if (fastClickModal) openModal(fastClickModal);
                });
            }
            // Hızlı Tıkla! modalındaki kapatma butonu
            if (fastClickModalCloseBtn) {
                fastClickModalCloseBtn.addEventListener('click', () => {
                    if (fastClickModal) closeModal(fastClickModal);
                });
            }

            // Sayı Tahmin Oyunu kartına tıklama olayı (modalı açar)
            if (guessGameCard) {
                guessGameCard.addEventListener('click', () => {
                    if (guessGameModal) openModal(guessGameModal);
                    startGame(); // Modalı açtığında oyunu başlat
                });
            }
            // Sayı Tahmin Oyunu modalındaki kapatma butonu
            if (guessGameModalCloseBtn) {
                guessGameModalCloseBtn.addEventListener('click', () => {
                    if (guessGameModal) closeModal(guessGameModal);
                });
            }

            // Taş, Kağıt, Makas kartına tıklama olayı (modalı açar)
            if (rpsGameCard) {
                rpsGameCard.addEventListener('click', () => {
                    if (rpsGameModal) openModal(rpsGameModal);
                    initializeRPSGame(); // Modalı açtığında oyunu başlat
                });
            }
            // Taş, Kağıt, Makas modalındaki kapatma butonu
            if (rpsGameModalCloseBtn) {
                rpsGameModalCloseBtn.addEventListener('click', () => {
                    if (rpsGameModal) closeModal(rpsGameModal);
                });
            }

            // Hızlı Tıkla! butonu için olay dinleyici (modal içinde)
            if (fastClickGameButton) { 
                fastClickGameButton.addEventListener('click', async () => {
                    if (!userId) {
                        showMessage("Kullanıcı verisi yükleniyor, lütfen bekleyin.", true, 'message-box-fast-click-modal');
                        return;
                    }

                    const now = Date.now();
                    const docSnap = await userDocRef.get();
                    if (docSnap.exists) {
                        const lastClick = docSnap.data().lastClick || 0;
                        if (now - lastClick < 500) { 
                            showMessage("Çok hızlısın! Lütfen biraz bekle.", false, 'message-box-fast-click-modal');
                            return;
                        }
                    }

                    try {
                        await userDocRef.update({
                            points: (docSnap.data().points || 0) + 10,
                            lastClick: now
                        });
                        showMessage("Puan kazandın!", false, 'message-box-fast-click-modal');
                    } catch (e) {
                        console.error("Puan güncellenirken hata oluştu: ", e);
                        showMessage("Bir hata oluştu, lütfen tekrar deneyin.", true, 'message-box-fast-click-modal');
                    }
                });
            } else {
                console.error("Hata: fastClickGameButton HTML elementi bulunamadı!");
                showMessage("Uygulama yüklenirken bir sorun oluştu (Oyun Butonu bulunamadı).", true, 'message-box-home');
            }

            // Çarkıfelek kartına tıklama olayı (modalı açar)
            if (wheelCard) {
                wheelCard.addEventListener('click', () => {
                    if (wheelModal) openModal(wheelModal);
                });
            } else {
                console.error("Hata: wheelCard HTML elementi bulunamadı!");
            }

            // Çark modalındaki kapatma butonu
            if (wheelModalCloseBtn) {
                wheelModalCloseBtn.addEventListener('click', () => {
                    if (wheelModal) closeModal(wheelModal);
                });
            } else {
                console.error("Hata: wheelModalCloseBtn HTML elementi bulunamadı!");
            }

            // Çarkı çevir butonu (modal içinde)
            if (wheelSpinButton) { // ID güncellendi
                wheelSpinButton.addEventListener('click', async () => {
                    if (!userId) return;
                    isSpinning = true;
                    wheelSpinButton.disabled = true;
                    wheelSpinButton.textContent = "Çevriliyor...";

                    try {
                        const docSnap = await userDocRef.get();
                        const currentPoints = docSnap.data().points || 0;

                        if (currentPoints < 100) {
                            showMessage("Yeterli puanın yok!", true, 'message-box-wheel-modal');
                            isSpinning = false;
                            wheelSpinButton.disabled = false;
                            wheelSpinButton.textContent = "Çarkı Çevir (100 Puan)";
                            return;
                        }

                        await userDocRef.update({
                            points: currentPoints - 100
                        });

                        const targetSegmentIndex = Math.floor(Math.random() * segments.length);
                        const segmentAngle = 360 / segments.length;
                        const totalAngle = 360 * 5 + (360 - (targetSegmentIndex * segmentAngle + segmentAngle / 2));
                        
                        wheelElement.style.transform = `rotate(${totalAngle}deg)`;
                        
                        setTimeout(async () => {
                            const result = segments[targetSegmentIndex];
                            if (result.type === 'bonus_code') {
                                const newBonusCode = `BONUS-${Math.random().toString(36).substring(2, 10).toUpperCase()}`;
                                await userDocRef.update({
                                    bonusCodes: firebase.firestore.FieldValue.arrayUnion(newBonusCode)
                                });
                                showMessage(`Tebrikler! ${result.text} kazandın. Kodun: ${newBonusCode}`, false, 'message-box-wheel-modal');
                            } else {
                                showMessage("Maalesef, bir dahaki sefere!", false, 'message-box-wheel-modal');
                            }
                            
                            isSpinning = false;
                            wheelSpinButton.disabled = false;
                            wheelSpinButton.textContent = "Çarkı Çevir (100 Puan)";
                            wheelElement.style.transform = 'rotate(0deg)'; // Çarkı başlangıç konumuna döndür
                        }, 5000); // 5 saniye animasyon süresi
                    } catch (e) {
                        console.error("Çark çevrilirken bir hata oluştu: ", e);
                        showMessage("Bir hata oluştu, lütfen tekrar deneyin.", true, 'message-box-wheel-modal');
                        isSpinning = false;
                        wheelSpinButton.disabled = false;
                        wheelSpinButton.textContent = "Çarkı Çevir (100 Puan)";
                    }
                });
            } else {
                console.error("Hata: wheelSpinButton HTML elementi bulunamadı!");
                showMessage("Uygulama yüklenirken bir sorun oluştu (Çark Butonu bulunamadı).", true, 'message-box-home');
            }
            
            // createWheel çağrısı wheelElement atandıktan sonra yapılmalı
            if (wheelElement) {
                createWheel(); 
            } else {
                console.error("Hata: wheelElement HTML elementi bulunamadı!");
            }

            // Sayı Tahmin Oyunu Olay Dinleyicileri (modal içinde)
            if (guessGameSubmitButton) {
                guessGameSubmitButton.addEventListener('click', checkGuess);
            }
            if (guessGameNewButton) {
                guessGameNewButton.addEventListener('click', startGame);
            }
            
            // Taş-Kağıt-Makas Oyunu Olay Dinleyicileri (modal içinde)
            if (rpsRockBtn) rpsRockBtn.addEventListener('click', () => playRPSGame('taş'));
            if (rpsPaperBtn) rpsPaperBtn.addEventListener('click', () => playRPSGame('kağıt'));
            if (rpsScissorsBtn) rpsScissorsBtn.addEventListener('click', () => playRPSGame('makas'));
            if (rpsPlayAgainButton) rpsPlayAgainButton.addEventListener('click', initializeRPSGame);
            
            initializeFirebase();
        });
    </script>
</body>
</html>
